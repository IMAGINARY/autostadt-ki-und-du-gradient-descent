{"version":3,"sources":["node_modules/browser-pack/_prelude.js","js/controls/controls.js","js/controls/gamepad.js","js/controls/keyboard.js","js/controls/screen.js","js/game-mode-numplayers.js","js/game-mode-play.js","js/game-mode-title.js","js/game-mode.js","js/game.js","js/main.js","js/terrain.js","js/waves.js","js/wavy-animation.js","node_modules/events/events.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","1","module","Controls","count","_classCallCheck","this","states","Array","fill","map","_","left","right","action","statesModified","id","key","value","result","s","Object","assign","_controls","GamepadControls","_super","_this","_toConsumableArray","from","navigator","getGamepads","filter","gp","index","forEach","modifyState","axes","buttons","pressed","updateState","_get","_getPrototypeOf","prototype","keyMap","ArrowLeft","prop","ArrowRight","ArrowDown","KeyA","KeyD","KeyS","keyCodes","keys","preventDefaultActionForKeys","includes","preventDefault","KeyboardControls","keyCallback","ev","type","window","addEventListener","ScreenControls","element","document","createElement","classList","add","concat","appendChild","buildControl","mousePressedButton","name","remove","_this2","root","newButton","button","checkTouches","targetTouches","setAttribute","passive","_gameMode","PlayerNumberMode","$overlay","$","game","overlay","maxPlayers","config","selectedNumber","selectorItems","text","IMAGINARY","i18n","appendTo","$selector","addClass","toggleClass","inputs","lastInputs","newSelection","find","ctrl","direction","Math","max","min","removeClass","numPlayers","triggerEvent","_events","_interopRequireDefault","_terrain","waves","_interopRequireWildcard","TERRAIN_DISTANCE","PlayMode","wavesPoints","points","draw","width","loadSVGSymbol","shipSymbol","attr","overflow","treasureClosedSymbol","treasureOpenedSymbol","gameOver","discardInputs","modeGroup","group","translate","players","playerIndex","x","transform","translateX","boat","use","center","probeParent","probe","line","height","circle","translateY","_probingDone","probeClip","rect","PROBE_SIZE","move","clipWith","flipX","_probing","_probeEventEmitter","probing","probeTurnedOff","emit","probingDone","_asyncToGenerator","regeneratorRuntime","mark","_callee2","_this3","wrap","_context2","prev","next","abrupt","Promise","resolve","addListener","stop","apply","arguments","water","polyline","groundGroup","terrainOptions","marginWidth","terrainHeights","terrainPoints","h","treasureLocation","locateTreasure","console","log","behindGroundGroup","treasure","y","treasureClosed","treasureOpened","hide","ground","groundClip","clip","tangents","delta","_this4","_this$game2","slice","input","lastInput","actionDown","player","terrainHeight","probeHeight","probeDuration","runnerDown","animate","after","addGroundClip","addTangent","treasureFound","abs","TREASURE_SIZE","_callee5","uncoverGroundPromise","_context5","uncoverGround","all","showGameOverSequence","ts","_this$game3","plot","slope","boatTransform","rotate","atan2","PI","flip","terrainHeightExt","xInArray","tmpIndex","floor","i0","i1","h0","h1","array","treasureIndex","reduce","m","arr","_this$terrainHeightEx","angle","w","polygon","scaleX","show","dy","ease","pos","sqrt","children","winner","delay","ms","setTimeout","treasureAnnouncement","treasureString","random","randomElement","restartString","$treasureAnnouncementDiv","$treasureDiv","css","$restartDiv","$inner","append","bottom","$outer","empty","_wavyAnimation","TitleMode","logoSprite","poly","findOne","pressToStart","textContent","size","stroke","color","duration","wavyStep","animCounter","GameMode","events","_gameModePlay","_gameModeTitle","_gameModeNumplayers","_gamepad","_screen","_keyboard","GradientDescentGame","container","createInputs","inputsLast","gameLoop","isPaused","modes","currentMode","controls","debugControlsPane","viewContainer","svgDoc","SVG","addTo","viewbox","nested","useScreenControls","screen","useGamepads","gamepad","useKeyboardControls","keyboard","debugControls","registerMode","continuousGame","transition","setMode","uri","clearStyles","fetch","response","status","statusText","symbol","newSymbol","svg","inputReducer","accInput","curState","values","getStates","join","lastTs","lag","readInputs","handleInputs","requestAnimationFrame","run","mode","preLoadAssets","modeID","pause","handleExitMode","undefined","clear","innerHTML","handleEnterMode","resume","modeId","event","nextModeId","callback","on","_game","_main","defaultConfig","defaultLanguage","loadConfig","sent","json","t0","message","_callee","_context","t1","t2","t3","init","queryStringVariable","translationsDirectory","querySelector","t4","error","numSamples","options","defaultOptions","numHeights","heights","j","convertPointsToHeights","smoothChaikin","num","open","l","smooth","flat","numPoints","marginHeight","jitter","Float32Array","marginIndices","predefinedHeights","_ref","_ref2","_slicedToArray","_ref3","_ref4","_ref5","_ref6","generateInnerTerrainHeights","leftHeight","rightHeight","_subdivide","subarray","generateTerrainPoints","smoothing","PERIOD","cos","svgContainer","numSteps","xScale","yScale","keyframes","keyframesString","replace","attributeName","dur","repeatCount","sin","shape","userOptions","xAmplitude","cycles","polygons","originalPlots","maxY","counter","progress","pow","objectCreate","create","proto","F","objectKeys","obj","k","hasOwnProperty","push","bind","Function","context","fn","EventEmitter","_eventsCount","_maxListeners","hasDefineProperty","defaultMaxListeners","defineProperty","err","$getMaxListeners","that","_addListener","target","listener","prepend","existing","TypeError","newListener","unshift","warned","String","emitter","warn","onceWrapper","fired","removeListener","wrapFn","args","_onceWrap","state","wrapped","_listeners","unwrap","evlistener","ret","unwrapListeners","arrayClone","listenerCount","copy","enumerable","get","set","arg","setMaxListeners","isNaN","getMaxListeners","er","handler","len","doError","isFn","self","listeners","emitNone","arg1","emitOne","arg2","emitTwo","arg3","emitThree","emitMany","prependListener","once","prependOnceListener","list","position","originalListener","shift","pop","spliceOne","removeAllListeners","rawListeners","eventNames","Reflect","ownKeys"],"mappings":"CAAA,SAAAA,EAAAC,EAAAC,EAAAC,GAAA,SAAAC,EAAAC,EAAAC,GAAA,IAAAJ,EAAAG,GAAA,CAAA,IAAAJ,EAAAI,GAAA,CAAA,IAAAE,EAAA,mBAAAC,SAAAA,QAAA,IAAAF,GAAAC,EAAA,OAAAA,EAAAF,GAAA,GAAA,GAAAI,EAAA,OAAAA,EAAAJ,GAAA,GAAA,IAAAK,EAAA,IAAAC,MAAA,uBAAAN,EAAA,KAAA,MAAAK,EAAAE,KAAA,mBAAAF,EAAA,IAAAG,EAAAX,EAAAG,GAAA,CAAAS,QAAA,IAAAb,EAAAI,GAAA,GAAAU,KAAAF,EAAAC,QAAA,SAAAd,GAAA,OAAAI,EAAAH,EAAAI,GAAA,GAAAL,IAAAA,IAAAa,EAAAA,EAAAC,QAAAd,EAAAC,EAAAC,EAAAC,GAAA,OAAAD,EAAAG,GAAAS,QAAA,IAAA,IAAAL,EAAA,mBAAAD,SAAAA,QAAAH,EAAA,EAAAA,EAAAF,EAAAa,OAAAX,IAAAD,EAAAD,EAAAE,IAAA,OAAAD,EAAA,CAAA,CAAAa,EAAA,CAAA,SAAAT,EAAAU,EAAAJ,4PCIqBK,aAOnB,SAAAA,EAAYC,gGAAOC,CAAAC,KAAAH,GACjBG,KAAKC,OAASC,MAAMJ,GACjBK,KAAK,MACLC,IAAI,SAAAC,GAAC,MAAK,CACTC,MAAM,EACNC,OAAO,EACPC,QAAQ,KAEZR,KAAKS,gBAAiB,6DAQZC,EAAIC,EAAKC,GACfZ,KAAKC,OAAOS,GAAIC,KAASC,IAC3BZ,KAAKC,OAAOS,GAAIC,GAAOC,EACvBZ,KAAKS,gBAAiB,uCAiBxB,GAAIT,KAAKS,eAAgB,CACvB,IAAMI,EAASb,KAAKC,OAGpB,OAFAD,KAAKC,OAASD,KAAKC,OAAOG,IAAI,SAAAU,GAAC,OAAIC,OAAOC,OAAO,GAAIF,KACrDd,KAAKS,gBAAiB,EACfI,EAEP,OAAOb,KAAKC,+JCrDlB,MAAAgB,KAAA/B,EAAA,uuEAMqBgC,mPAAwBD,EAAA,6BAO3C,SAAAC,EAAYpB,GAAO,mGAAAC,CAAAC,KAAAkB,GAAAC,EAAA1B,KAAAO,KACXF,sDAGM,IAAAsB,EAAApB,KAEZA,KAAKC,OAALoB,EAAkBrB,KAAKC,QACvBC,MAAMoB,KAAKC,UAAUC,eAClBC,OAAO,SAAAC,GAAE,OAAW,OAAPA,GAAeA,EAAGC,MAAQP,EAAKnB,OAAOP,SACnDkC,QAAQ,SAAAF,GACPN,EAAKS,YAAYH,EAAGC,MAAO,OAAQD,EAAGI,KAAK,IAAM,IACjDV,EAAKS,YAAYH,EAAGC,MAAO,QAAsB,GAAbD,EAAGI,KAAK,IAC5CV,EAAKS,YAAYH,EAAGC,MAAO,SAAUD,EAAGK,QAAQ,GAAGC,SAAWN,EAAGK,QAAQ,GAAGC,+CAkBhF,OADAhC,KAAKiC,cACLC,EAAAC,EAAAjB,EAAAkB,WAAA,YAAApC,MAAAP,KAAAO,4KC3CJ,MAAAiB,KAAA/B,EAAA,4iCAEA,IAAMmD,EAAS,CACbC,UAAa,CAAE5B,GAAI,EAAG6B,KAAM,QAC5BC,WAAc,CAAE9B,GAAI,EAAG6B,KAAM,SAC7BE,UAAa,CAAE/B,GAAI,EAAG6B,KAAM,UAC5BG,KAAQ,CAAEhC,GAAI,EAAG6B,KAAM,QACvBI,KAAQ,CAAEjC,GAAI,EAAG6B,KAAM,SACvBK,KAAQ,CAAElC,GAAI,EAAG6B,KAAM,WAEnBM,EAAW9B,OAAO+B,KAAKT,GAK7B,SAASU,EAA4BpE,GAC/BkE,EAASG,SAASrE,EAAEW,OACtBX,EAAEsE,qBASeC,mPAAyBjC,EAAA,uBAO5C,SAAAiC,EAAYpD,GAAO,IAAAsB,+FAAArB,CAAAC,KAAAkD,GACjB9B,EAAAD,EAAA1B,KAAAO,KAAMF,GAEc,SAAdqD,EAAcC,GAClB,IAAMzC,EAAM0B,EAAOe,EAAG9D,MAClBqB,GAAOA,EAAID,GAAKZ,GAClBsB,EAAKS,YAAYlB,EAAID,GAAIC,EAAI4B,KAAkB,YAAZa,EAAGC,MANzB,OASjBC,OAAOC,iBAAiB,UAAWJ,GACnCG,OAAOC,iBAAiB,QAASJ,GACjCG,OAAOC,iBAAiB,UAAWR,GAA6B,GAX/C3B,+ICjCrB,MAAAH,KAAA/B,EAAA,stCAQqBsE,mPAAuBvC,EAAA,6BAO1C,SAAAuC,EAAY1D,GAAO,IAAAsB,+FAAArB,CAAAC,KAAAwD,IACjBpC,EAAAD,EAAA1B,KAAAO,KAAMF,IACD2D,QAAUC,SAASC,cAAc,OACtCvC,EAAKqC,QAAQG,UAAUC,IAAI,mBAC3BzC,EAAKqC,QAAQG,UAAUC,IAAvB,QAAAC,OAAmChE,EAAnC,cAEA,IAAK,IAAIf,EAAI,EAAGA,EAAIqC,EAAKnB,OAAOP,SAAUX,EACxCqC,EAAKqC,QAAQM,YAAY3C,EAAK4C,aAAajF,IAP5B,OAUjBqC,EAAK6C,mBAAqB,KAC1BX,OAAOC,iBAAiB,UAAW,WACD,OAA5BnC,EAAK6C,qBACP7C,EAAKS,YAAYT,EAAK6C,mBAAmBvD,GAAIU,EAAK6C,mBAAmBC,MAAM,GAC3E9C,EAAK6C,mBAAmBR,QAAQG,UAAUO,OAAO,UACjD/C,EAAK6C,mBAAqB,QAfb7C,oDA4BNV,GAAI,IAAA0D,EAAApE,KACTqE,EAAOX,SAASC,cAAc,OACpCU,EAAKT,UAAUC,IAAI,iBAAnB,kBAAAC,OAAuDpD,IAErC,SAAZ4D,EAAaJ,GACjB,IAAMK,EAASb,SAASC,cAAc,UAIjB,SAAfa,EAAgBpB,GACU,EAA1BA,EAAGqB,cAAc/E,QACnB0E,EAAKvC,YAAYnB,EAAIwD,GAAM,GAC3BK,EAAOX,UAAUC,IAAI,YAErBO,EAAKvC,YAAYnB,EAAIwD,GAAM,GAC3BK,EAAOX,UAAUO,OAAO,WAE1Bf,EAAGH,iBAkBL,OA7BAsB,EAAOG,aAAa,OAAQ,UAC5BH,EAAOX,UAAUC,IAAIK,GAarBK,EAAOhB,iBAAiB,aAAciB,EAAc,CAAEG,SAAS,IAC/DJ,EAAOhB,iBAAiB,YAAaiB,EAAc,CAAEG,SAAS,IAC9DJ,EAAOhB,iBAAiB,WAAYiB,EAAc,CAAEG,SAAS,IAC7DJ,EAAOhB,iBAAiB,cAAeiB,EAAc,CAAEG,SAAS,IAEhEJ,EAAOhB,iBAAiB,YAAa,WACnCa,EAAKvC,YAAYnB,EAAIwD,GAAM,GAC3BK,EAAOX,UAAUC,IAAI,UACrBO,EAAKH,mBAAqB,CACxBvD,GAAAA,EACAwD,KAAAA,EACAT,QAASc,KAINA,EAOT,OAJAF,EAAKN,YAAYO,EAAU,SAC3BD,EAAKN,YAAYO,EAAU,WAC3BD,EAAKN,YAAYO,EAAU,UAEpBD,wKCpFX,MAAAO,KAAA1F,EAAA,ihDAEqB2F,mPAAyBD,EAAA,wkBAgB1C,IAXME,EAAWC,EAAE/E,KAAKgF,KAAKC,SACrBC,EAAelF,KAAKgF,KAAKG,OAAzBD,WAERlF,KAAKoF,eAAiB,EACtBpF,KAAKqF,cAAgB,GACrBN,EAAE,qDACCO,KAAKC,UAAUC,KAAK3G,EAAE,uBACtB4G,SAASX,GACNY,EAAYX,EAAE,uCACjBY,SADe,4BAAA7B,OACsBoB,IACrCO,SAASX,GACH/F,EAAI,EAAGA,GAAKmG,EAAYnG,GAAK,EACpCiB,KAAKqF,cAActG,GAAKgG,EAAE,wBACvBY,SADqB,QAAA7B,OACJ/E,IACjB6G,YAAY,WAAY5F,KAAKoF,iBAAmBrG,GAChDuG,KAAKvG,GACL0G,SAASC,qWAQHG,EAAQC,GAAuB,IAClCZ,EAAelF,KAAKgF,KAAKG,OAAzBD,WAEJa,EAAe,KACfF,EAAOG,KAAK,SAACC,EAAMlH,GAAP,OACM,IAApBkH,EAAKC,YAAiD,IAA7BJ,EAAW/G,GAAGmH,YACvCH,EAAeI,KAAKC,IAAI,EAAGpG,KAAKoF,eAAiB,GACxCS,EAAOG,KAAK,SAACC,EAAMlH,GAAP,OACF,IAAnBkH,EAAKC,WAA+C,IAA5BJ,EAAW/G,GAAGmH,cACtCH,EAAeI,KAAKE,IAAInB,EAAYlF,KAAKoF,eAAiB,IAGxDW,GAAgBA,IAAiB/F,KAAKoF,iBACxCpF,KAAKqF,cAAcrF,KAAKoF,gBAAgBkB,YAAY,YACpDtG,KAAKqF,cAAcU,GAAcJ,SAAS,YAC1C3F,KAAKoF,eAAiBW,GAIpBF,EACDG,KAAK,SAACC,EAAMlH,GAAP,OAAakH,EAAKzF,SAAWsF,EAAW/G,GAAGyB,WACjDR,KAAKgF,KAAKuB,WAAavG,KAAKoF,eAC5BpF,KAAKwG,aAAa,gNCtDxB,IAAAC,EAAAC,EAAAxH,EAAA,WAEA0F,EAAA8B,EAAAxH,EAAA,gBACAyH,EAAAD,EAAAxH,EAAA,cACA0H,qaAAAC,CAAA3H,EAAA,yoDAEA,IAWM4H,EAAmB,IAmBJC,mPAAiBnC,EAAA,uCAEpC,SAAAmC,EAAY/B,GAAM,IAAA5D,+FAAArB,CAAAC,KAAA+G,GAChB3F,EAAAD,EAAA1B,KAAAO,KAAMgF,GACN,IAAMgC,EAAc9G,MAjCC,KAiCuBC,KAAK,MAFjC,OAGhBiB,EAAK4F,YAAc,SAAAnI,GAAC,OAAI+H,EAAMK,OAAOD,EAAanI,EAAGmG,EAAKkC,KAAKC,QAnCxC,KAgCP/F,qLAOQpB,KAAKgF,KAAKoC,cAAc,qCAAhDpH,KAAKqH,kBACLrH,KAAKqH,WAAWC,KAAK,CAAEC,SAAU,qBACCvH,KAAKgF,KAAKoC,cAAc,gDAA1DpH,KAAKwH,4BACLxH,KAAKwH,qBAAqBF,KAAK,CAAEC,SAAU,sBACTvH,KAAKgF,KAAKoC,cAAc,0CAA1DpH,KAAKyH,4BACLzH,KAAKyH,qBAAqBH,KAAK,CAAEC,SAAU,6RAIdvH,KAAKgF,KAA1BkC,IAAAA,KAAMX,IAAAA,WAEdvG,KAAK0H,UAAW,EAChB1H,KAAK2H,eAAgB,EAEfC,EAAYV,EAAKW,QACpBlC,SAAS,QACTA,SAAS,QACTmC,UAAU,EAtDM,KAyDnB9H,KAAK+H,QAAU7H,MAAMqG,GAClBpG,KAAK,MACLC,IAAI,SAACC,EAAG2H,GACP,IAAMC,GAAKD,EAAc,IAAMzB,EAAa,GACtCsB,EAAQD,EAAUC,QACxBA,EACGlC,SADH,UAAA7B,OACsBkE,IACnBE,UAAU,CAAEC,WAAYF,EAAIf,EAAKC,UAEpC,IAAMiB,EAAOP,EAAMQ,IAAIjE,EAAKiD,YACzBiB,OAAO,EAhEC,IAkELC,EAAcV,EAAMA,QACpBW,EAAQD,EAAYV,QAC1BW,EAAMC,KAAK,GAAIvB,EAAKwB,SAAU,GAAG,GACjCF,EAAMG,OA1DK,IA0DcL,OAAO,EAAG,GACnCE,EAAMN,UAAU,CAAEU,WAAY9B,KAG9B,IAsBa+B,EAtBPC,EAAYP,EAAYQ,KAAKC,GAAgB9B,EAAKwB,UACrDO,MAAK,GA1EG,IA6EX,OAFAV,EAAYW,SAASJ,GAEd,CACLpI,GAAIsH,EACJH,MAAOA,EACPO,KAAMA,EACNI,MAAOA,EACPP,EAAGA,EACHkB,OAAO,EACPC,UAAU,EACVC,mBAAoB,IAAI5C,EAAA,QACxB6C,YAAY/J,GACV,IAAMgK,EAAiBvJ,KAAKoJ,WAAa7J,EACzCS,KAAKoJ,SAAW7J,EACZgK,GACFvJ,KAAKqJ,mBAAmBG,KAAK,cAEjCF,cACE,OAAOtJ,KAAKoJ,UAEdK,aAAWZ,EAAAa,EAAAC,mBAAAC,KAAE,SAAAC,IAAA,IAAAC,EAAA9J,KAAA,OAAA2J,mBAAAI,KAAA,SAAAC,GAAA,OAAA,OAAAA,EAAAC,KAAAD,EAAAE,MAAA,KAAA,EAAA,GACNlK,KAAKsJ,QADC,CAAAU,EAAAE,KAAA,EAAA,MAAA,OAAAF,EAAAG,OAAA,UAAA,KAAA,EAAA,OAAAH,EAAAE,KAAA,EAGL,IAAIE,QAAQ,SAAAC,GAAO,OAAIP,EAAKT,mBAAmBiB,YAAY,YAAaD,KAHnE,KAAA,EAAA,IAAA,MAAA,OAAAL,EAAAO,SAAAV,EAAA7J,SAAF,WAAA,OAAA6I,EAAA2B,MAAAxK,KAAAyK,gBAQjBzK,KAAK0K,MAAQ9C,EAAUC,QACpB8C,SAAS3K,KAAKgH,YAAY,IAC1BrB,SAAS,SAEZ3F,KAAK4K,YAAchD,EAAUC,QACvBgD,EAAiB,CAAEC,YAvGA,IAwGnBC,GAAiB,EAAApE,EAAA,SAzGC,GADD,IA0GiDkE,GAClEG,EAAgBD,EAAe3K,IAAI,SAAC6K,EAAGlM,GAAJ,MAAU,CACjDmI,EAAKC,SAAWpI,GAAKgM,EAAerL,OAAS,IA7GtB,IA8GAuL,KAEzBjL,KAAK+K,eAAiBA,EACtB/K,KAAKkL,iBAAmBlL,KAAKmL,iBAC7BC,QAAQC,IAAI,qBAAsBrL,KAAKkL,kBAEjCI,EAAoBtL,KAAK4K,YAAY/C,QACrC0D,EAAWD,EAAkBzD,QAChClC,SAAS,YACTuC,UAAU,CACTC,WAAYnI,KAAKkL,iBAAiBjD,EAAIf,EAAKC,QAC3CyB,WAAY9B,EAzHS,IAyHU9G,KAAKkL,iBAAiBM,IAEzDxL,KAAKyL,eAAiBF,EAASlD,IAAIrI,KAAKwH,sBACxCxH,KAAK0L,eAAiBH,EAASlD,IAAIrI,KAAKyH,sBAAsBkE,OAG9D3L,KAAK4L,OAAS5L,KAAK4K,YAAYD,SAASK,GACrCrF,SAAS,UACTmC,UAAU,EAAGhB,GACb6E,OAEHL,EAAkBpC,SAASlJ,KAAK4K,YAAYvC,IAAIrI,KAAK4L,SAErD5L,KAAK6L,WAAa7L,KAAK4K,YAAYkB,OACnC9L,KAAK4K,YAAY1B,SAASlJ,KAAK6L,YAE/B7L,KAAK+L,SAAWnE,EAAUC,QACvBC,UAAU,EAAGhB,sWAOLjB,EAAQC,EAAYkG,GAAW,IAAAC,EAAAjM,KAG1C,IAAIA,KAAK2H,cAAT,CAH0C,IAAAuE,EAMblM,KAAKgF,KAApBuB,GAN4B2F,EAMlChF,KANkCgF,EAM5B3F,YACdV,EACGsG,MAAM,EAAG5F,GACT3E,QAAQ,SAACwK,EAAOpE,GACf,IAAMqE,EAAYvG,EAAWkC,GACvBsE,EAAaF,EAAM5L,SAAW6L,EAAU7L,OAC1CyL,EAAKvE,UAAY4E,GACnBL,EAAKzF,aAAa,QAEpB,IAAM+F,EAASN,EAAKlE,QAAQC,GAC5B,IAAKuE,EAAOjD,UAAY2C,EAAKvE,WAC3B6E,EAAOtE,GAAqB+D,EAAQI,EAAMlG,UA3J/B,KA4JXqG,EAAOtE,EAAI9B,KAAKE,IAAIF,KAAKC,IAhKN,GAgKgCmG,EAAOtE,GAAI,IAC9DsE,EAAOpD,MAA4B,IAApBiD,EAAMlG,UAAkBqG,EAAOpD,OAA6B,IAArBiD,EAAMlG,UACxDoG,GAAY,CAEdC,EAAOjD,SAAU,EAEjB,IAAMkD,EAAgBP,EAAKO,cAAcD,EAAOtE,GAC1CwE,EAAc3F,EA1KH,IA0K6C0F,EACxDE,EAhKS,IAgK2C5F,EAApC2F,EAChBE,EAAaJ,EAAO/D,MACvBoE,QAAQF,EAAe,EAAG,OAC1BxE,UAAU,CAAEU,WAAY6D,IACxBI,MAAM,WAAA,OAAMZ,EAAKa,cAAcP,EAAOtE,KACtC4E,MAAM,WAAA,OAAMZ,EAAKc,WAAWR,KAIzBS,GAHWL,EAAWC,QAAQF,EArK5B,KAsKLxE,UAAU,CAAEU,WAAY9B,KACxB+F,MAAM,WAAA,OAAMN,EAAOjD,SAAU,IACVnD,KAAK8G,IAAIV,EAAOtE,EAAIgE,EAAKf,iBAAiBjD,IAAMiF,MACtEP,EAAWE,MAAXnD,EAAAC,mBAAAC,KAAiB,SAAAuD,IAAA,IAAAC,EAAA,OAAAzD,mBAAAI,KAAA,SAAAsD,GAAA,OAAA,OAAAA,EAAApD,KAAAoD,EAAAnD,MAAA,KAAA,EAAA,GACX8C,IAAkBf,EAAKvE,SADZ,OAEb0D,QAAQC,IAAI,+BAEZY,EAAKvE,UAAW,EAGhBuE,EAAKtE,eAAgB,EACfyF,EAAuBnB,EAAKqB,gBARrBD,EAAAnD,KAAA,EASPE,QAAQmD,IAAItB,EAAKlE,QAAQ3H,IAAI,SAAAb,GAAC,OAAIA,EAAEkK,iBAT7B4D,EAAAnD,KAAA,GAAA,MAAA,KAAA,EAAA,OAAAmD,EAAAnD,KAAA,EAUP+B,EAAKuB,qBAAqBjB,GAVnB,KAAA,EAAA,OAWbN,EAAKtE,eAAgB,EAXR0F,EAAAnD,KAAA,GAYPkD,EAZO,KAAA,GAAA,IAAA,MAAA,OAAAC,EAAA9C,SAAA4C,OAiBjB/B,QAAQC,IAAR,UAAAvH,OAAsBkE,EAAtB,mBAAoD,CAAEC,EAAGsE,EAAOtE,EAAGuD,EAAGgB,qCAM3ER,EAAOyB,GAAI,IAAAC,EACe1N,KAAKgF,KAA1BkC,EADMwG,EACNxG,KADMwG,EACAnH,WAKdvG,KAAK0K,MAAMiD,KAAK3N,KAAKgH,YAAYyG,EAtNT,MAwNxBzN,KAAK+H,QAAQnG,QAAQ,SAAC2K,EAAQvE,GAC5B,IAAMC,EAAIsE,EAAOtE,EACXuD,EA7Ne,GA6NU5E,EAAM8B,OAAOT,EAAGwF,EA1NzB,KA2NhBG,EA9Ne,GA8NchH,EAAMgH,MAAM3F,EAAGwF,EA3N5B,KA6NhBI,EAAgB,CACpBC,OAFY,GAAa3H,KAAK4H,MAAMH,EAAO1G,EAAKC,SAAWhB,KAAK6H,IAI9DzB,EAAOpD,QACT0E,EAAcI,KAAO,KACvB1B,EAAOnE,KAAKF,UAAU2F,GACtBtB,EAAO1E,MAAMK,UAAU,CACrBC,WAAYF,EAAIf,EAAKC,QACrByB,WAAY4C,4CAKJvD,GACZ,OAAOjI,KAAKkO,iBAAiBjG,GAAGrH,+CAGjBqH,GACf,IAAMkG,GAAYnO,KAAK+K,eAAerL,OAAS,GAAKuI,EAC9CmG,EAAWjI,KAAKkI,MAAMF,GACtBG,EAAKF,IAAapO,KAAK+K,eAAerL,OAAS,EAAI0O,EAAW,EAAIA,EAClEG,EAAKD,EAAK,EACVE,EAAKxO,KAAK+K,eAAeuD,GACzBG,EAAKzO,KAAK+K,eAAewD,GAE/B,MAAO,CACL3N,MAAO4N,GAFCL,EAAWG,IAEFG,EAAKD,GACtBZ,OAAQa,EAAKD,IAAOxO,KAAK+K,eAAerL,OAAS,6CAKnD,IAAegP,EACTC,GADSD,EACc1O,KAAK+K,eADV,GAAG6D,OAAOnP,KAAKiP,EAAO,SAACG,EAAG5P,EAAGF,EAAG+P,GAAV,OAAkB7P,EAAI6P,EAAID,GAAK9P,EAAI8P,GAAG,IAEpF,MAAO,CACL5G,EAAG0G,GAAiB3O,KAAK+K,eAAerL,OAAS,GACjD8L,EAAGxL,KAAK+K,eAAe4D,uCAIhBpC,GAAQ,IAEXpF,EADWnH,KAAKgF,KAAdkC,KACWC,QAFF4H,EAGQ/O,KAAKkO,iBAAiB3B,EAAOtE,GAA9CrH,EAHSmO,EAGTnO,MAAOgN,EAHEmB,EAGFnB,MACToB,EAAQ,IAAM7I,KAAK4H,MArQA,IAqQMH,EAA8BzG,GAAShB,KAAK6H,GAC3EhO,KAAK+L,SAAStD,KAxPK,KAwPCtB,EAAyB,EAAG,EAxP7B,IAwPgCA,EAAyB,EAAG,GAC5ExB,SADH,UAAA7B,OACsByI,EAAO7L,KAC1BwH,UAAU,CACTC,WAAYhB,EAAQoF,EAAOtE,EAC3BW,WA1QqB,IA0QchI,EACnCkN,OAAQkB,0CAIA/G,GAAG,IACPf,EAASlH,KAAKgF,KAAdkC,KACF+H,EAAI/H,EAAKC,QACT8D,EAAI/D,EAAKwB,SACTK,EAAO/I,KAAK6L,WACfqD,QAAQ,CAAC,EAAED,GAAIhE,GAAI,CAACgE,GAAIhE,GAAI,CAACgE,EAAGhE,GAAI,EAAEgE,EAAGhE,KACzC3C,OAAOpB,EAAKC,QAAUc,EAAG,GACzBC,UAAU,CAAEiH,OAAQ,OACvBnP,KAAK6L,WAAWhI,IAAIkF,wKAIZ7B,EAASlH,KAAKgF,KAAdkC,KACRlH,KAAK4L,OAAOwD,OACcpP,KAAK6L,WAAWlD,OAAO,IAAoBzB,EAAKC,SACvEmB,OACCpB,EAAKC,QAAUnH,KAAKkL,iBAAiBjD,EACrCnB,EAhSqB,IAgSqB9G,KAAKkL,iBAAiBM,GAKlD6D,IAAG,KAA2BnI,EAAKC,SAE/CmG,EAAgB,SAAAxB,GAAI,OAAI,IAAI1B,QAAQ,SAAAC,GACxCyB,EAAKc,QAtRc,KAuRhB0C,KAAK,SAAAC,GAAG,QAAMpJ,KAAKqJ,KAAK,EAAKD,EAAMA,GAAQ,KAC3CrH,UAAU,CAAEiH,OAAQ,IACpBtC,MAAMxC,wBAEJD,QAAQmD,IAAIvN,KAAK6L,WAAW4D,WAAWrP,IAAIkN,0KAGzBoC,uHACjBxI,EAASlH,KAAKgF,KAAdkC,KACFpC,EAAWC,EAAE/E,KAAKgF,KAAKC,SAEvB0K,EAAQ,SAAAC,GAAE,OAAI,IAAIxF,QAAQ,SAAAC,GAAO,OAAIwF,WAAWxF,EAASuF,MAEzDE,EAAuBvK,UAAUC,KAAK3G,EAAE,gCACzC6Q,EAAOhP,GAAK,GACb6E,UAAUC,KAAK3G,EAAE,6BAEfkR,EADgB,SAAAjB,GAAG,OAAIA,EAAI3I,KAAKkI,MAAMlI,KAAK6J,UAAYlB,EAAIpP,OAAS,KACnDuQ,CAAc1K,UAAUC,KAAK3G,EAAE,cAChDqR,EAAgB3K,UAAUC,KAAK3G,EAAE,oBAEjCsR,EAA2BpL,EAAE,SAASO,KAAKwK,GAC3CM,EAAerL,EAAE,SAASO,KAAKyK,GAClCM,IAAI,aAAc,UACfC,EAAcvL,EAAE,0BAA0BO,KAAK4K,GAClDG,IAAI,aAAc,UAEfE,EAASxL,EAAC,4CAAAjB,OAA6C4L,EAAOhP,GAApD,SACb8P,OAAO,CAACL,EAA0BC,EAAcrL,EAAE,QAASuL,IAExDhQ,EAAO,IAAMN,KAAKkL,iBAAiBjD,EACnCwI,EAAS,IAAM,IAA4CvJ,EAAKwB,SAChEgI,EAAS3L,EAAE,iDACdsL,IAAI,CAAE/P,KAAI,GAAAwD,OAAKxD,EAAL,KAAcmQ,OAAM,GAAA3M,OAAK2M,EAAL,OAC9BD,OAAOD,aAEJZ,EAzToB,kBA0T1B7K,EAAS6L,QAAQH,OAAOE,aAElBf,EA3T6B,oBA4TnCS,EAAaC,IAAI,aAAc,WAC/BrQ,KAAK0L,eAAe0D,OACpBpP,KAAKyL,eAAeE,iBAEdgE,EA/T4B,aAgUlCW,EAAYD,IAAI,aAAc,mTCjWlC,IAAAzL,EAAA8B,EAAAxH,EAAA,gBACA0R,EAAAlK,EAAAxH,EAAA,6iDAEqB2R,mPAAkBjM,EAAA,uWAEX5E,KAAKgF,KAAKoC,cAAc,sCAAhDpH,KAAK8Q,kBACL9Q,KAAK+Q,KAAO/Q,KAAK8Q,WAAWE,QAAQ,qQAI5B9J,EAASlH,KAAKgF,KAAdkC,MACF+J,EAAevN,SAASC,cAAc,QAC/BC,UAAUC,IAAI,WAAY,OAAQ,cAAe,gBAC9DoN,EAAaC,YAAc3L,UAAUC,KAAK3G,EAAE,kBAC5CmB,KAAKgF,KAAKC,QAAQuL,OAAOS,GAEJ/J,EAAKmB,IAAIrI,KAAK8Q,YAChCK,KAAK,KAAM,KACXC,OAAO,CAAEC,MAAO,UAAWlK,MAAO,IAClChH,KAAK,eACLmI,OAAO,IAAU,KAEPsE,QAAQ,CAAE0E,SAAU,MAAQF,OAAO,CAAEC,MAAO,YACzDrR,KAAKuR,UAAW,EAAAX,EAAA,SAAc5Q,KAAK8Q,WAAY,CAAEQ,SAAU,OAE3DtR,KAAKwR,YAAc,oWAOR3L,EAAQC,GAEfD,EACDG,KAAK,SAACC,EAAMlH,GAAP,OAAakH,EAAKzF,SAAWsF,EAAW/G,GAAGyB,UACjDR,KAAKwG,aAAa,qCAIjBwF,EAAOyB,GAEVzN,KAAKuR,SAASvF,EAAOyB,gMC1CzB,MAAAhH,KAAAvH,EAAA,2gBAOqBuS,aAMnB,SAAAA,EAAYzM,gGAAMjF,CAAAC,KAAAyR,GAEhBzR,KAAKgF,KAAOA,EACZhF,KAAK0R,OAAS,IAAIjL,EAAA,8zBA4EPvC,GACXlE,KAAK0R,OAAOlI,KAAKtF,oKC7FrB,IAAAyN,EAAAjL,EAAAxH,EAAA,qBACA0S,EAAAlL,EAAAxH,EAAA,sBACA2S,EAAAnL,EAAAxH,EAAA,2BACA4S,EAAApL,EAAAxH,EAAA,uBACA6S,EAAArL,EAAAxH,EAAA,sBACA8S,EAAAtL,EAAAxH,EAAA,+iBAWqB+S,aACnB,SAAAA,EAAYC,EAAW/M,gGAAQpF,CAAAC,KAAAiS,GAC7BjS,KAAKkS,UAAYA,EACjBlS,KAAKmF,OAASA,EAEdnF,KAAK6F,OAAS7F,KAAKmS,eACnBnS,KAAKoS,WAAapS,KAAKmS,eAEvBnS,KAAKqS,SAAW,KAChBrS,KAAKsS,UAAW,EAChBtS,KAAKuS,MAAQ,GACbvS,KAAKwS,YAAc,KAEnBxS,KAAKyS,SAAW,GAChBzS,KAAK0S,kBAAoB,KAEzB1S,KAAKuG,WAAavG,KAAKmF,OAAOD,oMAU9BlF,KAAKiF,QAAUvB,SAASC,cAAc,OACtC3D,KAAKiF,QAAQrB,UAAUC,IAAI,YAErB8O,EAAgBjP,SAASC,cAAc,QAC/BC,UAAUC,IAAI,aAC5B7D,KAAKkS,UAAU1B,OAAOmC,GAEtB3S,KAAK4S,OAASC,MAAMC,MAAMH,GAC1B3S,KAAK4S,OACFG,QAAQ,EAAG,EAVW,KAAM,KAW5BzL,KAAK,sBAAuB,iBAE/BtH,KAAKkH,KAAOlH,KAAK4S,OAAOI,SAAS7B,KAbR,KAAM,KAe/BnR,KAAKiF,QAAUvB,SAASC,cAAc,OACtC3D,KAAKiF,QAAQrB,UAAUC,IAAI,WAC3B7D,KAAKkS,UAAU1B,OAAOxQ,KAAKiF,SAEvBjF,KAAKmF,OAAO8N,oBACdjT,KAAKyS,SAASS,OAAS,IAAInB,EAAA,QAAe/R,KAAKmF,OAAOD,YACtDlF,KAAKkS,UAAUnO,YAAY/D,KAAKyS,SAASS,OAAOzP,UAG9CzD,KAAKmF,OAAOgO,cACdnT,KAAKyS,SAASW,QAAU,IAAItB,EAAA,QAAgB9R,KAAKmF,OAAOD,aAEtDlF,KAAKmF,OAAOkO,sBACdrT,KAAKyS,SAASa,SAAW,IAAItB,EAAA,QAAiBhS,KAAKmF,OAAOD,aAGxDlF,KAAKmF,OAAOoO,gBACdvT,KAAK0S,kBAAoBhP,SAASC,cAAc,OAChD3D,KAAK0S,kBAAkB9O,UAAUC,IAAI,cACrC7D,KAAK0S,kBAAkB9O,UAAUC,IAAI,uBACrC7D,KAAKkS,UAAUnO,YAAY/D,KAAK0S,8BAG5B1S,KAAKwT,aAAa,QAAS,IAAI5B,EAAA,QAAU5R,gCACzCA,KAAKwT,aAAa,aAAc,IAAI3B,EAAA,QAAiB7R,gCACrDA,KAAKwT,aAAa,OAAQ,IAAI7B,EAAA,QAAS3R,kBAEzCA,KAAKmF,OAAOsO,sBACdzT,KAAK0T,WAAW,OAAQ,OAAQ,kBAC1B1T,KAAK2T,QAAQ,+DAEnB3T,KAAK0T,WAAW,QAAS,OACE,EAAzB1T,KAAKmF,OAAOD,WAAiB,aAAe,QAC9ClF,KAAK0T,WAAW,aAAc,OAAQ,QACtC1T,KAAK0T,WAAW,OAAQ,OAAQ,mBAC1B1T,KAAK2T,QAAQ,wKAYHC,+GAAKC,8CACAC,MAAMF,cAAvBG,UACOC,OAAS,KAA0B,KAAnBD,EAASC,aAC9B,IAAI3U,MAAJ,0BAAAyE,OAAoCiQ,EAASC,OAA7C,MAAAlQ,OAAwDiQ,EAASE,WAAjE,cAAAnQ,OAAwF8P,EAAxF,wCAEU5T,KAAK4S,OAAOsB,kBAAmBH,EAASzO,iCAApD6O,OAAiCC,oBACnCP,GACFM,EAAUnO,KAAK,SAASpE,QAAQ,SAAAd,GAAC,OAAIA,EAAEqD,6BAGlCgQ,mIASPnU,KAAK6F,OAAS7F,KAAKmS,sDAInB,OAAOjS,MAAMF,KAAKmF,OAAOD,YACtB/E,KAAK,MACLC,IAAI,WAAA,MAAO,CAAE8F,UAAW,EAAG1F,QAAQ,0CAYtCR,KAAKoS,WAAapS,KAAK6F,OAEF,SAAfwO,EAAgBC,EAAUC,GAAX,MAAyB,CAC5CrO,UAAWqO,EAAShU,MAAQ,EAAKgU,EAASjU,MAAQ,EAAIgU,EAASpO,UAC/D1F,OAAQ+T,EAAS/T,QAAU8T,EAAS9T,QAHtC,IAAMP,EAASc,OAAOyT,OAAOxU,KAAKyS,UAAUrS,IAAI,SAAAnB,GAAC,OAAIA,EAAEwV,cAKvDzU,KAAK6F,OAAS7F,KAAKmS,eAAe/R,IAChC,SAACgM,EAAOrN,GAAR,OAAckB,EAAOG,IAAI,SAAAU,GAAC,OAAIA,EAAE/B,KAAI6P,OAAOyF,EAAcjI,KAGvDpM,KAAK0S,oBACP1S,KAAK0S,kBAAkBxB,YAAclR,KAAK6F,OAAOzF,IAAI,SAAC6F,EAAMlH,GAAP,MAAA,IAAA+E,OAC/C/E,EAD+C,QAAA+E,OACvCmC,EAAKC,UADkC,OAAApC,OACnBmC,EAAKzF,OAAS,IAAM,OACnDkU,KAAK,uCAON,IAAAtT,EAAApB,KACJ,IAAKA,KAAKqS,SAAU,CAClB,IAAIsC,EAAS,EACTC,EAAM,EAGV5U,KAAKqS,SAAW,SAAC5E,GACf,IAAKrM,EAAKkR,SAAU,CAClBlR,EAAKyT,aAGL,IAAM7I,GADNyB,GADAmH,GAAOzO,KAAKC,IAAI,EAAIqH,EAAKmH,EAAOD,EALlB,MAOKA,EACnBvT,EAAKoR,YAAYsC,aAAa1T,EAAKyE,OAAQzE,EAAKgR,WAAYpG,EAAOyB,GACnErM,EAAKoR,YAAYtL,KAAK8E,EAAOyB,GAC7BkH,EAASlH,EAETnK,OAAOyR,sBAAsB3T,EAAKiR,YAIxC/O,OAAOyR,sBAAsB/U,KAAKqS,0CASlCrS,KAAKsS,UAAW,mCASZtS,KAAKsS,WACPtS,KAAKsS,UAAW,EAChBtS,KAAKgV,2EAcUtU,EAAIuU,yFACrBjV,KAAKuS,MAAM7R,GAAMuU,WACXA,EAAKC,2KAUCC,qFACZnV,KAAKoV,QAEDpV,KAAKwS,4BACDxS,KAAKwS,YAAY6C,+CAEEC,IAAvBtV,KAAKuS,MAAM4C,SACP,IAAI9V,MAAJ,gCAAAyE,OAA0CqR,iCAElDnV,KAAKwS,YAAcxS,KAAKuS,MAAM4C,GAC9BnV,KAAKkH,KAAKqO,QACVvV,KAAKiF,QAAQuQ,UAAY,aACnBxV,KAAKwS,YAAYiD,0BAEvBzV,KAAK0V,uIAGIC,EAAQC,OAA2C,IAAAxR,EAAApE,KAApC6V,EAAoC,EAAApL,UAAA/K,aAAA4V,QAAvB,KAAMQ,EAAiB,EAAArL,UAAA/K,aAAA4V,QAAN,KACtD,QAA2BA,IAAvBtV,KAAKuS,MAAMoD,GACb,MAAM,IAAItW,MAAJ,mDAAAyE,OAA6D6R,EAA7D,MAER,GAAIE,QAAyCP,IAA3BtV,KAAKuS,MAAMsD,GAC3B,MAAM,IAAIxW,MAAJ,iDAAAyE,OAA2D+R,EAA3D,MAER7V,KAAKuS,MAAMoD,GAAQjE,OAAOqE,GAAGH,EAAO,WAClC,GAAIxR,EAAKoO,cAAgBpO,EAAKmO,MAAMoD,GAClC,MAAM,IAAItW,MAAJ,QAAAyE,OAAkB6R,EAAlB,yBAAA7R,OAAgD8R,EAAhD,qDAEW,OAAfC,GACFzR,EAAKuP,QAAQkC,GAEXC,GAAgC,mBAAbA,GACrBA,uOClQR,MAAAE,KAAA9W,EAAA,iWAEA,IA8BC+W,EA9BKC,EAAgB,CACpBC,gBAAiB,KACjBhD,aAAa,EACbF,mBAAmB,EACnB/N,WAAY,EACZuO,gBAAgB,EAChBF,eAAe,YASF6C,mFAAf,SAAAvM,EAA0B+J,GAA1B,IAAAG,EAAA,OAAApK,mBAAAI,KAAA,SAAAC,GAAA,OAAA,OAAAA,EAAAC,KAAAD,EAAAE,MAAA,KAAA,EAAA,OAAAF,EAAAE,KAAA,EACyB4J,MAAMF,GAD/B,KAAA,EAAA,GAEyB,MADjBG,EADR/J,EAAAqM,MAEerC,QAAiBD,EAASC,OAAS,IAFlD,OAAAhK,EAAAC,KAAA,EAAAD,EAAAE,KAAA,EAImB6J,EAASuC,OAJ5BtM,EAAAE,KAAA,GAAA,MAAA,KAAA,EAAA,OAAAF,EAAAG,OAAA,SAAAH,EAAAqM,MAAA,KAAA,GAAA,MAAArM,EAAAC,KAAA,GAAAD,EAAAuM,GAAAvM,EAAA,MAAA,GAMY,IAAI3K,MAAJ,8BAAAyE,OAAwCkG,EAAAuM,GAAEC,UANtD,KAAA,GAAA,MASQ,IAAInX,MAAJ,0BAAAyE,OAAoCiQ,EAASC,OAA7C,MAAAlQ,OAAwDiQ,EAASE,WAAjE,2BATR,KAAA,GAAA,IAAA,MAAA,OAAAjK,EAAAO,SAAAV,EAAA,KAAA,CAAA,CAAA,EAAA,gCAeCoM,EAAAvM,EAAAC,mBAAAC,KAAA,SAAA6M,IAAA,IAAAtR,EAAAH,EAAA,OAAA2E,mBAAAI,KAAA,SAAA2M,GAAA,OAAA,OAAAA,EAAAzM,KAAAyM,EAAAxM,MAAA,KAAA,EAAA,OAAAwM,EAAAzM,KAAA,EAAAyM,EAAAH,GAEkBxV,OAFlB2V,EAAAC,GAEgC,GAFhCD,EAAAE,GAEoCV,EAFpCQ,EAAAxM,KAAA,EAEyDkM,EAAW,iBAFpE,KAAA,EAAA,OAAAM,EAAAG,GAAAH,EAAAL,KAESlR,EAFTuR,EAAAH,GAEyBvV,OAFzBvB,KAAAiX,EAAAH,GAAAG,EAAAC,GAAAD,EAAAE,GAAAF,EAAAG,IAAAH,EAAAxM,KAAA,GAGS3E,UAAUC,KAAKsR,KAAK,CACxBC,oBAAqB,OACrBC,sBAAuB,KACvBb,gBAAiBhR,EAAOgR,iBAAmB,OANhD,KAAA,GAAA,OASSnR,EAAO,IAAIgR,EAAA,QACftS,SAASuT,cAAc,SACvB9R,GAEF7B,OAAO0B,KAAOA,EAbjB0R,EAAAxM,KAAA,GAcSlF,EAAK8R,OAdd,KAAA,GAAAJ,EAAAxM,KAAA,GAAA,MAAA,KAAA,GAAAwM,EAAAzM,KAAA,GAAAyM,EAAAQ,GAAAR,EAAA,MAAA,GAiBGtL,QAAQ+L,MAART,EAAAQ,IAjBH,KAAA,GAAA,IAAA,MAAA,OAAAR,EAAAnM,SAAAkM,EAAA,KAAA,CAAA,CAAA,EAAA,SAAA,WAAAR,EAAAzL,MAAAxK,KAAAyK,WAAA,qjCCgEc,SAAiB2M,EAAY1X,GAAsB,IAAd2X,EAAc,EAAA5M,UAAA/K,aAAA4V,IAAA7K,UAAA,GAAAA,UAAA,GAAJ,GAU5D,OATA4M,EAAUtW,OAAOC,OAAO,GAAIsW,EAAgBD,GA1B9C,SAAgCpQ,EAAQsQ,GAMtC,IALA,IAAMjX,EAAO2G,EAAO,GAAG,GAEjBE,EADQF,EAAOA,EAAOvH,OAAS,GAAG,GAClBY,EAChBkX,EAAUtX,MAAMqX,GAClBE,EAAI,EACC1Y,EAAI,EAAGA,EAAIyY,EAAQ9X,OAAS,IAAKX,EAAG,CAC3C,KAAOA,IAAMwY,EAAa,IAAMtQ,EAAOwQ,GAAG,GAAKnX,GAAQ6G,KACnDsQ,EAEJ,IAAM5Y,GAAKyB,EAASvB,GAAKwY,EAAa,GAAMpQ,EAAUF,EAAOwQ,EAAI,GAAG,KAC/DxQ,EAAOwQ,GAAG,GAAKxQ,EAAOwQ,EAAI,GAAG,IAClCD,EAAQzY,GAAKkI,EAAOwQ,EAAI,GAAG,IAAMxQ,EAAOwQ,GAAG,GAAKxQ,EAAOwQ,EAAI,GAAG,IAAM5Y,EAGtE,OADA2Y,EAAQA,EAAQ9X,OAAS,GAAKuH,EAAOA,EAAOvH,OAAS,GAAG,GACjD8X,EAmBsBE,CA1G/B,SAASC,EAAc7I,EAAK8I,GAAkB,IAAbC,IAAa,EAAApN,UAAA/K,aAAA4V,IAAA7K,UAAA,KAAAA,UAAA,GAC5C,GAAY,IAARmN,EACF,OAAO9I,EAET,IAAMgJ,EAAIhJ,EAAIpP,OACd,IAAMqY,EAASjJ,EAAI1O,IAAI,SAACnB,EAAGF,GAAJ,MAAU,CAC/B,CAAC,IAAOE,EAAE,GAAK,IAAO6P,GAAK/P,EAAI,GAAK+Y,GAAG,GAAI,IAAO7Y,EAAE,GAAK,IAAO6P,GAAK/P,EAAI,GAAK+Y,GAAG,IACjF,CAAC,IAAO7Y,EAAE,GAAK,IAAO6P,GAAK/P,EAAI,GAAK+Y,GAAG,GAAI,IAAO7Y,EAAE,GAAK,IAAO6P,GAAK/P,EAAI,GAAK+Y,GAAG,OAChFE,OAECH,MACFE,EAAOrY,OACPqY,EAAO,GAAKjJ,EAAI,GAChBiJ,EAAOA,EAAOrY,OAAS,GAAKoP,EAAIA,EAAIpP,OAAS,IAG/C,OAAOiY,EAAcI,EAAQH,EAAM,EAAGC,GAyFVF,CAnE9B,SAA+BM,GAAiE,IAAtDnN,EAAsD,EAAAL,UAAA/K,aAAA4V,IAAA7K,UAAA,GAAAA,UAAA,GAAxC,GAAKyN,EAAmC,EAAAzN,UAAA/K,aAAA4V,IAAA7K,UAAA,GAAAA,UAAA,GAApB,GAAK0N,EAAe,EAAA1N,UAAA/K,aAAA4V,IAAA7K,UAAA,GAAAA,UAAA,GAAN,IAClF+M,EAAU,IAAIY,aAAaH,GAC3BI,EAAgB,CACpBlS,KAAKkI,MAAMvD,EAAcmN,GACzB9R,KAAKkI,MAAMvD,GAAe,EAAI,EAAIA,GAAemN,IAE7CK,EAAoB,CACxB,CAAC,EAAGnS,KAAK6J,SAAWkI,GACpB,CAACG,EAAc,GAAIH,GACnB,CAACG,EAAc,GAAK,EAAIlS,KAAKkI,MAAMlI,KAAK6J,UAAYqI,EAAc,GAAKA,EAAc,KACpF,GACD,CAACA,EAAc,GAAIH,GACnB,CAACD,EAAY,EAAG9R,KAAK6J,SAAWkI,IAGlB,EAAZD,IACFK,EAAkB1W,QAAQ,SAAA2W,GAAA,IAAAC,EAAAC,EAAAF,EAAA,GAAExZ,EAAFyZ,EAAA,GAAKvN,EAALuN,EAAA,GAAA,OAAYhB,EAAQzY,GAAKkM,IACnDqN,EAAkB1J,OAAO,SAAA8J,EAAAC,GAAwB,IAAAC,EAAAH,EAAAC,EAAA,GAAtBpK,EAAsBsK,EAAA,GAAlBpK,EAAkBoK,EAAA,GAAAC,EAAAJ,EAAAE,EAAA,GAAZpK,EAAYsK,EAAA,GAARpK,EAAQoK,EAAA,GAE/C,OA/BN,SAASC,EAA4BtB,EAASuB,EAAYC,GACxD,GAAqB,EAAjBxB,EAAQ9X,OAAY,CAAA,IAAAuZ,GARPvZ,EASqB8X,EAAQ9X,OATrBqZ,EAS6BA,EATjBC,EAS6BA,EAR3D,CACLrX,MAAOwE,KAAKkI,MAAM3O,EAASyG,KAAK6J,UAChCtH,OAAQvC,KAAKC,IAAI2S,EAAYC,GAAe7S,KAAK6J,WAMzCrO,EADcsX,EACdtX,MAAO+G,EADOuQ,EACPvQ,OACf8O,EAAQ7V,GAAS+G,EACjBoQ,EAA4BtB,EAAQ0B,SAAS,EAAGvX,GAAQoX,EAAYrQ,GACpEoQ,EAA4BtB,EAAQ0B,SAASvX,EAAQ,EAAG6V,EAAQ9X,QAC9DgJ,EACAsQ,GAdN,IAAmBtZ,EAAQqZ,EAAYC,EAgBrC,OAAOxB,EAqBHsB,CAA4BtB,EAAQ0B,SAAS5K,EAAK,EAAGC,GAAKC,EAAIC,GACvD,CAACF,EAAIE,MAOhB,OAFA0J,EAAShS,KAAKC,IAAI,EAAKD,KAAKE,IAAI8R,EAAQ,IAEjC,IAAIjY,MAAMsX,EAAQ9X,QACtBS,KAAK,MACLC,IAAI,SAACC,EAAGtB,GAAJ,MAAU,EACZA,EAAIoZ,GAAUhS,KAAK6J,SAAW,MAASwH,EAAQ9X,OAAS,GACzD8X,EAAQzY,MA+Beoa,CACzB/B,EACAC,EAAQvM,YACRuM,EAAQa,aACRb,EAAQc,QAEoDd,EAAQ+B,WACG1Z,IAhB3E,IAAM4X,EAAiB,CACrBxM,YAAa,GACboN,aAAc,GACdC,OAAQ,IACRiB,UAAW,6GC9EN,SAAenR,EAAGpJ,GAEvB,OADAA,EAAKA,EAAIwa,EAAUA,GAEjB,IAAMlT,KAAKmT,IAAI,IAAMrR,EAAIpJ,GACvB,GAAKsH,KAAKmT,IAAI,GAAKrR,EAAIpJ,GACvB,GAAKsH,KAAKmT,IAAI,GAAKrR,EAAI,EAAIpJ,GAC3B,GAAKsH,KAAKmT,IAAI,GAAKrR,EAAI,EAAIpJ,IAC3B,aAGC,SAAiBiQ,EAAKjQ,GAE3B,OADAiQ,EAAIlN,QAAQ,SAACvB,EAAGtB,GAAJ,OAAU+P,EAAI/P,GAAK2J,EAAO3J,GAAK+P,EAAIpP,OAAS,GAAIb,KACrDiQ,4BAiBF,SAAqByK,EAActB,EAAWuB,EAAUC,EAAQC,EAAQpI,GAC7E,IAAM/R,EAAIW,MAAM+X,GAAW9X,KAAK,MAC1BwZ,EAAYzZ,MAAMsZ,GACrBrZ,KAAK,MACLC,IAAI,SAACC,EAAGtB,GAAJ,OAAUmB,MAAMoB,KAAK2F,EAAO1H,EAAGR,GAAKya,EAAW,GAAIC,EAAQC,MAC5D9S,EAAQ2S,EAAa5O,SAASgP,EAAU,IAExCC,EADeD,EAAUvZ,IAAI,SAAAb,GAAC,OAAIqH,EAAM+G,KAAKpO,GAAG+H,KAAK,YACtBoN,KAAK,OAAOmF,QAAQ,mBAAoB,KAS7E,OARgBjT,EAAMnD,QAAQ,WACtB6D,KAAK,CACXwS,cAAe,SACfC,IAAG,GAAAjW,OAAKwN,EAAL,MACH0I,YAAa,aACbxF,OAAQoF,IAGHhT,GAzDT,IAAMyS,EAAS,GAAKlT,KAAK6H,GAElB,SAAStF,EAAOT,EAAGpJ,GAExB,OADAA,EAAKA,EAAIwa,EAAUA,GAEjBlT,KAAK8T,IAAQ,IAAJhS,EAAUpJ,GACjBsH,KAAK8T,IAAQ,GAAJhS,EAAapJ,GACtBsH,KAAK8T,IAAQ,GAAJhS,EAAS,EAAIpJ,GACtBsH,KAAK8T,IAAQ,GAAJhS,EAAS,EAAIpJ,IACtB,EAkBC,SAASoI,EAAO6H,EAAKjQ,GAA+B,IAA5B4a,EAA4B,EAAAhP,UAAA/K,aAAA4V,IAAA7K,UAAA,GAAAA,UAAA,GAAnB,EAAKiP,EAAc,EAAAjP,UAAA/K,aAAA4V,IAAA7K,UAAA,GAAAA,UAAA,GAAL,EAKpD,OAJAqE,EAAIlN,QAAQ,SAACvB,EAAGtB,GACd,IAAMkJ,EAAIlJ,GAAK+P,EAAIpP,OAAS,GAC5BoP,EAAI/P,GAAK,CAAC0a,EAASxR,EAAGyR,EAAShR,EAAOT,EAAGpJ,MAEpCiQ,iiCCbM,SAAuBoL,GAAyB,IAAlBC,EAAkB,EAAA1P,UAAA/K,aAAA4V,IAAA7K,UAAA,GAAAA,UAAA,GAAJ,GAOnD4M,EAAUtW,OAAOC,OAAO,GANP,CACrBoZ,WAAY,GACZ9I,SAAU,IACV+I,OAAQ,GAGwCF,GAC5CG,EAAWJ,EAAMlU,KAAK,WACtBuU,EAAgBD,EAASla,IAAI,SAAAb,GAAC,OAAIA,EAAEoO,SACpC6M,EAAOrU,KAAKC,IAALoE,MAAArE,2VAAI9E,CAAQkZ,EAAcvC,OAAO5X,IAAI,SAAAmY,GAAA,OAAAE,EAAAF,EAAA,GAAA,OAE9CkC,EAAU,EAEd,OAAO,SAACzO,EAAOyB,GACb,KAAIgN,EAAUpD,EAAQ/F,UAAtB,CAGAmJ,GAAWzO,EACX,IAAM0O,EAAWvU,KAAKE,IAAIoU,EAASpD,EAAQ/F,UAAY+F,EAAQ/F,SAC/DgJ,EAAS1Y,QAAQ,SAACrC,EAAGR,GACnBQ,EAAEoO,KAAK4M,EAAcxb,GAAGqB,IAAI,SAAAsY,GAAA,IAAAC,EAAAF,EAAAC,EAAA,GAAEzQ,EAAF0Q,EAAA,GAAKnN,EAALmN,EAAA,GAAA,MAC1B,CACE1Q,EAAI9B,KAAK8T,KAAKzO,EAAIgP,EAAOE,EAAWrD,EAAQgD,QAAUlU,KAAK6H,GAAK,GAC9DqJ,EAAQ+C,YAAc,EAAAjU,KAAAwU,IAAKD,EAAY,IACzClP,oCC3BV,IAAAoP,EAAA7Z,OAAA8Z,QAoeA,SAAAC,GACA,SAAAC,KAEA,OADAA,EAAA3Y,UAAA0Y,EACA,IAAAC,GAteAC,EAAAja,OAAA+B,MAweA,SAAAmY,GACA,IAAAnY,EAAA,GACA,IAAA,IAAAoY,KAAAD,EAAAla,OAAAqB,UAAA+Y,eAAA1b,KAAAwb,EAAAC,IACApY,EAAAsY,KAAAF,GAEA,OAAAA,GA5eAG,EAAAC,SAAAlZ,UAAAiZ,MA8eA,SAAAE,GACA,IAAAC,EAAAxb,KACA,OAAA,WACA,OAAAwb,EAAAhR,MAAA+Q,EAAA9Q,aA/eA,SAAAgR,IACAzb,KAAAyG,SAAA1F,OAAAqB,UAAA+Y,eAAA1b,KAAAO,KAAA,aACAA,KAAAyG,QAAAmU,EAAA,MACA5a,KAAA0b,aAAA,GAGA1b,KAAA2b,cAAA3b,KAAA2b,oBAAArG,IAEA1V,EAAAJ,QAAAic,GAGAA,aAAAA,GAEArZ,UAAAqE,aAAA6O,EACAmG,EAAArZ,UAAAuZ,mBAAArG,EAIA,IAEAsG,EAFAC,EAAA,GAGA,IACA,IAAA/c,EAAA,GACAiC,OAAA+a,gBAAA/a,OAAA+a,eAAAhd,EAAA,IAAA,CAAA8B,MAAA,IACAgb,EAAA,IAAA9c,EAAAmJ,EACA,MAAA8T,GAAAH,GAAA,EA4BA,SAAAI,EAAAC,GACA,YAAA3G,IAAA2G,EAAAN,cACAF,EAAAI,oBACAI,EAAAN,cAyHA,SAAAO,EAAAC,EAAA9Y,EAAA+Y,EAAAC,GACA,IAAAxN,EACA6C,EACA4K,EAEA,GAAA,mBAAAF,EACA,MAAA,IAAAG,UAAA,0CAoBA,IAlBA7K,EAAAyK,EAAA1V,UAOAiL,EAAA8K,cACAL,EAAA3S,KAAA,cAAAnG,EACA+Y,EAAAA,SAAAA,EAAAA,SAAAA,GAIA1K,EAAAyK,EAAA1V,SAEA6V,EAAA5K,EAAArO,KAbAqO,EAAAyK,EAAA1V,QAAAmU,EAAA,MACAuB,EAAAT,aAAA,GAeAY,GAmBA,GAdA,mBAAAA,EAEAA,EAAA5K,EAAArO,GACAgZ,EAAA,CAAAD,EAAAE,GAAA,CAAAA,EAAAF,GAGAC,EACAC,EAAAG,QAAAL,GAEAE,EAAAlB,KAAAgB,IAKAE,EAAAI,SACA7N,EAAAmN,EAAAG,KACA,EAAAtN,GAAAyN,EAAA5c,OAAAmP,EAAA,CACAyN,EAAAI,QAAA,EACA,IAAAzN,EAAA,IAAA5P,MAAA,+CACAid,EAAA5c,OAAA,KAAAid,OAAAtZ,GAAA,uEAGA4L,EAAA/K,KAAA,8BACA+K,EAAA2N,QAAAT,EACAlN,EAAA5L,KAAAA,EACA4L,EAAAnP,MAAAwc,EAAA5c,OACA,iBAAA0L,SAAAA,QAAAyR,MACAzR,QAAAyR,KAAA,SAAA5N,EAAA/K,KAAA+K,EAAAuH,eA9BA8F,EAAA5K,EAAArO,GAAA+Y,IACAD,EAAAT,aAmCA,OAAAS,EAcA,SAAAW,IACA,IAAA9c,KAAA+c,MAGA,OAFA/c,KAAAmc,OAAAa,eAAAhd,KAAAqD,KAAArD,KAAAid,QACAjd,KAAA+c,OAAA,EACAtS,UAAA/K,QACA,KAAA,EACA,OAAAM,KAAAoc,SAAA3c,KAAAO,KAAAmc,QACA,KAAA,EACA,OAAAnc,KAAAoc,SAAA3c,KAAAO,KAAAmc,OAAA1R,UAAA,IACA,KAAA,EACA,OAAAzK,KAAAoc,SAAA3c,KAAAO,KAAAmc,OAAA1R,UAAA,GAAAA,UAAA,IACA,KAAA,EACA,OAAAzK,KAAAoc,SAAA3c,KAAAO,KAAAmc,OAAA1R,UAAA,GAAAA,UAAA,GACAA,UAAA,IACA,QAEA,IADA,IAAAyS,EAAA,IAAAhd,MAAAuK,UAAA/K,QACAX,EAAA,EAAAA,EAAAme,EAAAxd,SAAAX,EACAme,EAAAne,GAAA0L,UAAA1L,GACAiB,KAAAoc,SAAA5R,MAAAxK,KAAAmc,OAAAe,IAKA,SAAAC,EAAAhB,EAAA9Y,EAAA+Y,GACA,IAAAgB,EAAA,CAAAL,OAAA,EAAAE,YAAA3H,EAAA6G,OAAAA,EAAA9Y,KAAAA,EAAA+Y,SAAAA,GACAiB,EAAAhC,EAAA5b,KAAAqd,EAAAM,GAGA,OAFAC,EAAAjB,SAAAA,EACAgB,EAAAH,OAAAI,EA2HA,SAAAC,EAAAnB,EAAA9Y,EAAAka,GACA,IAAA7L,EAAAyK,EAAA1V,QAEA,IAAAiL,EACA,MAAA,GAEA,IAAA8L,EAAA9L,EAAArO,GACA,OAAAma,EAGA,mBAAAA,EACAD,EAAA,CAAAC,EAAApB,UAAAoB,GAAA,CAAAA,GAEAD,EAsDA,SAAAzO,GAEA,IADA,IAAA2O,EAAA,IAAAvd,MAAA4O,EAAApP,QACAX,EAAA,EAAAA,EAAA0e,EAAA/d,SAAAX,EACA0e,EAAA1e,GAAA+P,EAAA/P,GAAAqd,UAAAtN,EAAA/P,GAEA,OAAA0e,EA3DAC,CAAAF,GAAAG,EAAAH,EAAAA,EAAA9d,QALA,GAyBA,SAAAke,EAAAva,GACA,IAAAqO,EAAA1R,KAAAyG,QAEA,GAAAiL,EAAA,CACA,IAAA8L,EAAA9L,EAAArO,GAEA,GAAA,mBAAAma,EACA,OAAA,EACA,GAAAA,EACA,OAAAA,EAAA9d,OAIA,OAAA,EAcA,SAAAie,EAAA7O,EAAAlQ,GAEA,IADA,IAAAif,EAAA,IAAA3d,MAAAtB,GACAG,EAAA,EAAAA,EAAAH,IAAAG,EACA8e,EAAA9e,GAAA+P,EAAA/P,GACA,OAAA8e,EA3bAjC,EACA7a,OAAA+a,eAAAL,EAAA,sBAAA,CACAqC,YAAA,EACAC,IAAA,WACA,OAAAlC,GAEAmC,IAAA,SAAAC,GAGA,GAAA,iBAAAA,GAAAA,EAAA,GAAAA,GAAAA,EACA,MAAA,IAAA1B,UAAA,mDACAV,EAAAoC,KAIAxC,EAAAI,oBAAAA,EAKAJ,EAAArZ,UAAA8b,gBAAA,SAAAtf,GACA,GAAA,iBAAAA,GAAAA,EAAA,GAAAuf,MAAAvf,GACA,MAAA,IAAA2d,UAAA,0CAEA,OADAvc,KAAA2b,cAAA/c,EACAoB,MASAyb,EAAArZ,UAAAgc,gBAAA,WACA,OAAApC,EAAAhc,OA4DAyb,EAAArZ,UAAAoH,KAAA,SAAAnG,EAAA,EAAA,EAAA,GACA,IAAAgb,EAAAC,EAAAC,EAAArB,EAAAne,EAAA2S,EACA8M,EAAA,UAAAnb,EAGA,GADAqO,EAAA1R,KAAAyG,QAEA+X,EAAAA,GAAA,MAAA9M,EAAAyF,WACA,IAAAqH,EACA,OAAA,EAGA,GAAAA,EAAA,CAGA,GAFA,EAAA/T,UAAA/K,SACA2e,EAbA,GAcAA,aAAAhf,MACA,MAAAgf,EAGA,IAAAtC,EAAA,IAAA1c,MAAA,6BAAAgf,EAAA,KAEA,MADAtC,EAAAR,QAAA8C,EACAtC,EAOA,KAFAuC,EAAA5M,EAAArO,IAGA,OAAA,EAEA,IAAAob,EAAA,mBAAAH,EAEA,OADAC,EAAA9T,UAAA/K,QAGA,KAAA,GAtFA,SAAA4e,EAAAG,EAAAC,GACA,GAAAD,EACAH,EAAA7e,KAAAif,QAIA,IAFA,IAAAH,EAAAD,EAAA5e,OACAif,EAAAhB,EAAAW,EAAAC,GACAxf,EAAA,EAAAA,EAAAwf,IAAAxf,EACA4f,EAAA5f,GAAAU,KAAAif,GAgFAE,CAAAN,EAAAG,EAAAze,MACA,MACA,KAAA,GA/EA,SAAAse,EAAAG,EAAAC,EAAAG,GACA,GAAAJ,EACAH,EAAA7e,KAAAif,EAAAG,QAIA,IAFA,IAAAN,EAAAD,EAAA5e,OACAif,EAAAhB,EAAAW,EAAAC,GACAxf,EAAA,EAAAA,EAAAwf,IAAAxf,EACA4f,EAAA5f,GAAAU,KAAAif,EAAAG,GAyEAC,CAAAR,EAAAG,EAAAze,KAtCA,GAuCA,MACA,KAAA,GAxEA,SAAAse,EAAAG,EAAAC,EAAAG,EAAAE,GACA,GAAAN,EACAH,EAAA7e,KAAAif,EAAAG,EAAAE,QAIA,IAFA,IAAAR,EAAAD,EAAA5e,OACAif,EAAAhB,EAAAW,EAAAC,GACAxf,EAAA,EAAAA,EAAAwf,IAAAxf,EACA4f,EAAA5f,GAAAU,KAAAif,EAAAG,EAAAE,GAkEAC,CAAAV,EAAAG,EAAAze,KAzCA,EAAA,GA0CA,MACA,KAAA,GAjEA,SAAAse,EAAAG,EAAAC,EAAAG,EAAAE,EAAAE,GACA,GAAAR,EACAH,EAAA7e,KAAAif,EAAAG,EAAAE,EAAAE,QAIA,IAFA,IAAAV,EAAAD,EAAA5e,OACAif,EAAAhB,EAAAW,EAAAC,GACAxf,EAAA,EAAAA,EAAAwf,IAAAxf,EACA4f,EAAA5f,GAAAU,KAAAif,EAAAG,EAAAE,EAAAE,GA2DAC,CAAAZ,EAAAG,EAAAze,KA5CA,EAAA,EAAA,GA6CA,MAEA,QAEA,IADAkd,EAAA,IAAAhd,MAAAqe,EAAA,GACAxf,EAAA,EAAAA,EAAAwf,EAAAxf,IACAme,EAAAne,EAAA,GAAA0L,UAAA1L,IA7DA,SAAAuf,EAAAG,EAAAC,EAAAxB,GACA,GAAAuB,EACAH,EAAA9T,MAAAkU,EAAAxB,QAIA,IAFA,IAAAqB,EAAAD,EAAA5e,OACAif,EAAAhB,EAAAW,EAAAC,GACAxf,EAAA,EAAAA,EAAAwf,IAAAxf,EACA4f,EAAA5f,GAAAyL,MAAAkU,EAAAxB,GAuDAiC,CAAAb,EAAAG,EAAAze,KAAAkd,GAGA,OAAA,GA0EAzB,EAAArZ,UAAA2T,GAJA0F,EAAArZ,UAAAkI,YAAA,SAAAjH,EAAA+Y,GACA,OAAAF,EAAAlc,KAAAqD,EAAA+Y,GAAA,IAKAX,EAAArZ,UAAAgd,gBACA,SAAA/b,EAAA+Y,GACA,OAAAF,EAAAlc,KAAAqD,EAAA+Y,GAAA,IAkCAX,EAAArZ,UAAAid,KAAA,SAAAhc,EAAA+Y,GACA,GAAA,mBAAAA,EACA,MAAA,IAAAG,UAAA,0CAEA,OADAvc,KAAA+V,GAAA1S,EAAA8Z,EAAAnd,KAAAqD,EAAA+Y,IACApc,MAGAyb,EAAArZ,UAAAkd,oBACA,SAAAjc,EAAA+Y,GACA,GAAA,mBAAAA,EACA,MAAA,IAAAG,UAAA,0CAEA,OADAvc,KAAAof,gBAAA/b,EAAA8Z,EAAAnd,KAAAqD,EAAA+Y,IACApc,MAIAyb,EAAArZ,UAAA4a,eACA,SAAA3Z,EAAA+Y,GACA,IAAAmD,EAAA7N,EAAA8N,EAAAzgB,EAAA0gB,EAEA,GAAA,mBAAArD,EACA,MAAA,IAAAG,UAAA,0CAGA,KADA7K,EAAA1R,KAAAyG,SAEA,OAAAzG,KAGA,KADAuf,EAAA7N,EAAArO,IAEA,OAAArD,KAEA,GAAAuf,IAAAnD,GAAAmD,EAAAnD,WAAAA,EACA,KAAApc,KAAA0b,aACA1b,KAAAyG,QAAAmU,EAAA,cAEAlJ,EAAArO,GACAqO,EAAAsL,gBACAhd,KAAAwJ,KAAA,iBAAAnG,EAAAkc,EAAAnD,UAAAA,SAEA,GAAA,mBAAAmD,EAAA,CAGA,IAFAC,GAAA,EAEAzgB,EAAAwgB,EAAA7f,OAAA,EAAA,GAAAX,EAAAA,IACA,GAAAwgB,EAAAxgB,KAAAqd,GAAAmD,EAAAxgB,GAAAqd,WAAAA,EAAA,CACAqD,EAAAF,EAAAxgB,GAAAqd,SACAoD,EAAAzgB,EACA,MAIA,GAAAygB,EAAA,EACA,OAAAxf,KAEA,IAAAwf,EACAD,EAAAG,QAuHA,SAAAH,EAAA5d,GACA,IAAA,IAAA5C,EAAA4C,EAAAuZ,EAAAnc,EAAA,EAAAH,EAAA2gB,EAAA7f,OAAAwb,EAAAtc,EAAAG,GAAA,EAAAmc,GAAA,EACAqE,EAAAxgB,GAAAwgB,EAAArE,GACAqE,EAAAI,MAxHAC,CAAAL,EAAAC,GAEA,IAAAD,EAAA7f,SACAgS,EAAArO,GAAAkc,EAAA,IAEA7N,EAAAsL,gBACAhd,KAAAwJ,KAAA,iBAAAnG,EAAAoc,GAAArD,GAGA,OAAApc,MAGAyb,EAAArZ,UAAAyd,mBACA,SAAAxc,GACA,IAAAsb,EAAAjN,EAAA3S,EAGA,KADA2S,EAAA1R,KAAAyG,SAEA,OAAAzG,KAGA,IAAA0R,EAAAsL,eAUA,OATA,IAAAvS,UAAA/K,QACAM,KAAAyG,QAAAmU,EAAA,MACA5a,KAAA0b,aAAA,GACAhK,EAAArO,KACA,KAAArD,KAAA0b,aACA1b,KAAAyG,QAAAmU,EAAA,aAEAlJ,EAAArO,IAEArD,KAIA,GAAA,IAAAyK,UAAA/K,OAAA,CACA,IACAiB,EADAmC,EAAAkY,EAAAtJ,GAEA,IAAA3S,EAAA,EAAAA,EAAA+D,EAAApD,SAAAX,EAEA,oBADA4B,EAAAmC,EAAA/D,KAEAiB,KAAA6f,mBAAAlf,GAKA,OAHAX,KAAA6f,mBAAA,kBACA7f,KAAAyG,QAAAmU,EAAA,MACA5a,KAAA0b,aAAA,EACA1b,KAKA,GAAA,mBAFA2e,EAAAjN,EAAArO,IAGArD,KAAAgd,eAAA3Z,EAAAsb,QACA,GAAAA,EAEA,IAAA5f,EAAA4f,EAAAjf,OAAA,EAAA,GAAAX,EAAAA,IACAiB,KAAAgd,eAAA3Z,EAAAsb,EAAA5f,IAIA,OAAAiB,MAmBAyb,EAAArZ,UAAAuc,UAAA,SAAAtb,GACA,OAAAia,EAAAtd,KAAAqD,GAAA,IAGAoY,EAAArZ,UAAA0d,aAAA,SAAAzc,GACA,OAAAia,EAAAtd,KAAAqD,GAAA,IAGAoY,EAAAmC,cAAA,SAAAhB,EAAAvZ,GACA,MAAA,mBAAAuZ,EAAAgB,cACAhB,EAAAgB,cAAAva,GAEAua,EAAAne,KAAAmd,EAAAvZ,IAIAoY,EAAArZ,UAAAwb,cAAAA,EAiBAnC,EAAArZ,UAAA2d,WAAA,WACA,OAAA,EAAA/f,KAAA0b,aAAAsE,QAAAC,QAAAjgB,KAAAyG,SAAA","file":"bundle.min.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","/**\n * Component that handles gamepad controls\n *\n */\nexport default class Controls {\n  /**\n   * Constructor\n   *\n   * @param {Number} count\n   *  (Integer) Number of controllers to handle\n   */\n  constructor(count) {\n    this.states = Array(count)\n      .fill(null)\n      .map(_ => ({\n        left: false,\n        right: false,\n        action: false,\n      }));\n    this.statesModified = false;\n  }\n\n  /**\n   * Builds a single on-screen controller\n   *\n   * @protected\n   */\n  modifyState(id, key, value) {\n    if (this.states[id][key] !== value) {\n      this.states[id][key] = value;\n      this.statesModified = true;\n    }\n  }\n\n  /**\n   * Returns state of all controllers\n   *\n   * State is returned as an array with one object per controller\n   * with properties indicating the state of each button.\n   *\n   * @return {[{\n   *   left: Boolean,\n   *   right: Boolean,\n   *   action: Boolean\n   * }]}\n   */\n  getStates() {\n    if (this.statesModified) {\n      const result = this.states;\n      this.states = this.states.map(s => Object.assign({}, s)); // immutability: use cloned array for future changes\n      this.statesModified = false;\n      return result;\n    } else {\n      return this.states;\n    }\n  }\n}\n","import Controls from \"./controls\";\n\n/**\n * Component that handles gamepad controls\n *\n */\nexport default class GamepadControls extends Controls {\n  /**\n   * Constructor\n   *\n   * @param {Number} count\n   *  (Integer) Number of controllers to show\n   */\n  constructor(count) {\n    super(count);\n  }\n\n  updateState() {\n    // clone the current state such state objects are immutable\n    this.states = [...this.states];\n    Array.from(navigator.getGamepads())\n      .filter(gp => gp !== null && gp.index < this.states.length)\n      .forEach(gp => {\n        this.modifyState(gp.index, \"left\", gp.axes[0] < -0.5);\n        this.modifyState(gp.index, \"right\", gp.axes[0] > 0.5);\n        this.modifyState(gp.index, \"action\", gp.buttons[1].pressed || gp.buttons[2].pressed);\n      });\n  }\n\n  /**\n   * Returns state of all controllers\n   *\n   * State is returned as an array with one object per controller\n   * with properties indicating the state of each button.\n   *\n   * @return {[{\n   *   left: Boolean,\n   *   right: Boolean,\n   *   action: Boolean\n   * }]}\n   */\n  getStates() {\n    this.updateState();\n    return super.getStates();\n  }\n}\n","import Controls from \"./controls\";\n\nconst keyMap = {\n  'ArrowLeft': { id: 0, prop: 'left' },\n  'ArrowRight': { id: 0, prop: 'right' },\n  'ArrowDown': { id: 0, prop: 'action' },\n  'KeyA': { id: 1, prop: 'left' },\n  'KeyD': { id: 1, prop: 'right' },\n  'KeyS': { id: 1, prop: 'action' },\n};\nconst keyCodes = Object.keys(keyMap);\n\n/**\n * Certain default actions like scrolling should be prevented for the keys used for the game.\n */\nfunction preventDefaultActionForKeys(e) {\n  if (keyCodes.includes(e.code))\n    e.preventDefault();\n}\n\n/**\n * Component that handles keyboard controls\n *\n * Supports up to two players at the moment.\n *\n */\nexport default class KeyboardControls extends Controls {\n  /**\n   * Constructor\n   *\n   * @param {Number} count\n   *  (Integer) Number of controllers to show\n   */\n  constructor(count) {\n    super(count);\n\n    const keyCallback = ev => {\n      const key = keyMap[ev.code];\n      if (key && key.id < count)\n        this.modifyState(key.id, key.prop, ev.type === 'keydown');\n    };\n\n    window.addEventListener('keydown', keyCallback);\n    window.addEventListener('keyup', keyCallback);\n    window.addEventListener(\"keydown\", preventDefaultActionForKeys, false);\n  }\n}\n","import Controls from \"./controls\";\n\n/**\n * Component that handles on-screen controls\n *\n * Supports both mouse and multitouch input.\n *\n */\nexport default class ScreenControls extends Controls {\n  /**\n   * Constructor\n   *\n   * @param {Number} count\n   *  (Integer) Number of controllers to show\n   */\n  constructor(count) {\n    super(count);\n    this.element = document.createElement('div');\n    this.element.classList.add('screen-controls');\n    this.element.classList.add(`with-${count}-controls`);\n\n    for (let i = 0; i < this.states.length; ++i)\n      this.element.appendChild(this.buildControl(i));\n\n    // Global mouseup handling for all buttons\n    this.mousePressedButton = null;\n    window.addEventListener('mouseup', () => {\n      if (this.mousePressedButton !== null) {\n        this.modifyState(this.mousePressedButton.id, this.mousePressedButton.name, false);\n        this.mousePressedButton.element.classList.remove('active');\n        this.mousePressedButton = null;\n      }\n    });\n  }\n\n  /**\n   * Builds a single on-screen controller\n   *\n   * @private\n   * @param {Number} id\n   *  Zero-based integer index of the controller\n   * @return {HTMLDivElement}\n   */\n  buildControl(id) {\n    const root = document.createElement('div');\n    root.classList.add('screen-control', `screen-control-${id}`);\n\n    const newButton = (name) => {\n      const button = document.createElement('button');\n      button.setAttribute('type', 'button');\n      button.classList.add(name);\n\n      const checkTouches = (ev) => {\n        if (ev.targetTouches.length > 0) {\n          this.modifyState(id, name, true);\n          button.classList.add('active');\n        } else {\n          this.modifyState(id, name, false);\n          button.classList.remove('active');\n        }\n        ev.preventDefault();\n      };\n\n      button.addEventListener('touchstart', checkTouches, { passive: false });\n      button.addEventListener('touchmove', checkTouches, { passive: false });\n      button.addEventListener('touchend', checkTouches, { passive: false });\n      button.addEventListener('touchcancel', checkTouches, { passive: false });\n\n      button.addEventListener('mousedown', () => {\n        this.modifyState(id, name, true);\n        button.classList.add('active');\n        this.mousePressedButton = {\n          id,\n          name,\n          element: button,\n        };\n      });\n\n      return button;\n    };\n\n    root.appendChild(newButton('left'));\n    root.appendChild(newButton('action'));\n    root.appendChild(newButton('right'));\n\n    return root;\n  }\n}\n","/* globals IMAGINARY */\nimport GameMode from './game-mode';\n\nexport default class PlayerNumberMode extends GameMode {\n  async preLoadAssets() {\n  }\n\n  async handleEnterMode() {\n    const $overlay = $(this.game.overlay);\n    const { maxPlayers } = this.game.config;\n\n    this.selectedNumber = 1;\n    this.selectorItems = {};\n    $('<div class=\"text text-center numPlayers-title\" />')\n      .text(IMAGINARY.i18n.t('choose-num-players'))\n      .appendTo($overlay);\n    const $selector = $('<div class=\"numPlayers-selector\" />')\n      .addClass(`numPlayers-selector-with-${maxPlayers}`)\n      .appendTo($overlay);\n    for (let i = 1; i <= maxPlayers; i += 1) {\n      this.selectorItems[i] = $('<div class=\"item\" />')\n        .addClass(`item-${i}`)\n        .toggleClass('selected', this.selectedNumber === i)\n        .text(i)\n        .appendTo($selector);\n    }\n  }\n\n  async handleExitMode() {\n    // Cleanup timers, etc. created on handleEnterMode\n  }\n\n  handleInputs(inputs, lastInputs, delta, ts) {\n    const { maxPlayers } = this.game.config;\n\n    let newSelection = null;\n    if (inputs.find((ctrl, i) => (\n      ctrl.direction === -1 && lastInputs[i].direction !== -1))) {\n      newSelection = Math.max(1, this.selectedNumber - 1);\n    } else if (inputs.find((ctrl, i) => (\n      ctrl.direction === 1 && lastInputs[i].direction !== 1))) {\n      newSelection = Math.min(maxPlayers, this.selectedNumber + 1);\n    }\n\n    if (newSelection && newSelection !== this.selectedNumber) {\n      this.selectorItems[this.selectedNumber].removeClass('selected');\n      this.selectorItems[newSelection].addClass('selected');\n      this.selectedNumber = newSelection;\n    }\n\n    // If any button was pressed\n    if (inputs\n      .find((ctrl, i) => ctrl.action && !lastInputs[i].action)) {\n      this.game.numPlayers = this.selectedNumber;\n      this.triggerEvent('done');\n    }\n  }\n\n  draw(delta, ts) {\n    // Move boats\n    // Draw bottom\n    // etc...\n  }\n}\n","import EventEmitter from 'events';\n\nimport GameMode from './game-mode';\nimport terrain from './terrain';\nimport * as waves from './waves';\n\nconst WATER_HEIGHT_SCALE = 10;\nconst NUM_WATER_POINTS = 300;\nconst WATER_DISTANCE = 200;\nconst WATER_LOOP_DURATION = 20 * 1000;\n\nconst BOAT_DRAFT = 18;\n\nconst TERRAIN_HEIGHT_SCALE = 300;\nconst NUM_TERRAIN_POINTS = 300;\nconst MAX_TERRAIN_EXTREMA = 20;\nconst TERRAIN_MARGIN_WIDTH = 0.1;\nconst TERRAIN_DISTANCE = 300;\n\n// How far should the boat move on user input per ms\nconst SPEED_FACTOR = 0.2 / 1000.0;\n\nconst PROBE_SIZE = 10;\nconst PROBE_DISTANCE_AT_REST = 0.3;\nconst PROBE_MIN_DURATION = 500;\nconst PROBE_DELAY = 500;\n\nconst TANGENT_LENGTH = 0.02;\n\nconst TREASURE_SIZE = 0.03;\n\nconst UNCOVER_DURATION = 2000;\nconst ENDING_SEQUENCE_DELAY = 0;\nconst ENDING_SEQUENCE_TREASURE_DELAY = 1000;\nconst ENDING_SEQUENCE_RESTART_DELAY = 2000;\n\nexport default class PlayMode extends GameMode {\n\n  constructor(game) {\n    super(game);\n    const wavesPoints = Array(NUM_WATER_POINTS).fill(null);\n    this.wavesPoints = t => waves.points(wavesPoints, t, game.draw.width(), WATER_HEIGHT_SCALE);\n  }\n\n  async preLoadAssets() {\n    this.shipSymbol = await this.game.loadSVGSymbol('assets/img/ship.svg');\n    this.shipSymbol.attr({ overflow: 'visible' });\n    this.treasureClosedSymbol = await this.game.loadSVGSymbol('assets/img/treasure-closed.svg');\n    this.treasureClosedSymbol.attr({ overflow: 'visible' });\n    this.treasureOpenedSymbol = await this.game.loadSVGSymbol('assets/img/treasure-opened.svg');\n    this.treasureOpenedSymbol.attr({ overflow: 'visible' });\n  }\n\n  async handleEnterMode() {\n    const { draw, numPlayers } = this.game;\n\n    this.gameOver = false;\n    this.discardInputs = false;\n\n    const modeGroup = draw.group()\n      .addClass('play')\n      .addClass('draw')\n      .translate(0, WATER_DISTANCE);\n\n    // Create a boat for each player\n    this.players = Array(numPlayers)\n      .fill(null)\n      .map((_, playerIndex) => {\n        const x = (playerIndex + 1) / (numPlayers + 1);\n        const group = modeGroup.group();\n        group\n          .addClass(`player-${playerIndex}`)\n          .transform({ translateX: x * draw.width() });\n\n        const boat = group.use(this.shipSymbol)\n          .center(0, BOAT_DRAFT);\n\n        const probeParent = group.group();\n        const probe = probeParent.group();\n        probe.line(0, -draw.height(), 0, -PROBE_SIZE / 2);\n        probe.circle(PROBE_SIZE).center(0, 0);\n        probe.transform({ translateY: TERRAIN_DISTANCE * PROBE_DISTANCE_AT_REST });\n\n        // Clip the probe such that only the part below the boat is visible.\n        const probeClip = probeParent.rect(PROBE_SIZE * 4, draw.height())\n          .move(-PROBE_SIZE * 2, BOAT_DRAFT);\n        probeParent.clipWith(probeClip);\n\n        return {\n          id: playerIndex,\n          group: group,\n          boat: boat,\n          probe: probe,\n          x: x,\n          flipX: false,\n          _probing: false,\n          _probeEventEmitter: new EventEmitter(),\n          set probing(p) {\n            const probeTurnedOff = this._probing && !p;\n            this._probing = p;\n            if (probeTurnedOff)\n              this._probeEventEmitter.emit(\"probe-off\");\n          },\n          get probing() {\n            return this._probing;\n          },\n          probingDone: async function () {\n            if (!this.probing)\n              return;\n            await new Promise(resolve => this._probeEventEmitter.addListener(\"probe-off\", resolve));\n          }\n        };\n      });\n\n    this.water = modeGroup.group()\n      .polyline(this.wavesPoints(0))\n      .addClass('water');\n\n    this.groundGroup = modeGroup.group();\n    const terrainOptions = { marginWidth: TERRAIN_MARGIN_WIDTH };\n    const terrainHeights = terrain(MAX_TERRAIN_EXTREMA, NUM_TERRAIN_POINTS, terrainOptions);\n    const terrainPoints = terrainHeights.map((h, i) => [\n      draw.width() * (i / (terrainHeights.length - 1)),\n      TERRAIN_HEIGHT_SCALE * h,\n    ]);\n    this.terrainHeights = terrainHeights;\n    this.treasureLocation = this.locateTreasure();\n    console.log(\"Treasure location:\", this.treasureLocation);\n\n    const behindGroundGroup = this.groundGroup.group();\n    const treasure = behindGroundGroup.group()\n      .addClass('treasure')\n      .transform({\n        translateX: this.treasureLocation.x * draw.width(),\n        translateY: TERRAIN_DISTANCE + this.treasureLocation.y * TERRAIN_HEIGHT_SCALE,\n      });\n    this.treasureClosed = treasure.use(this.treasureClosedSymbol);\n    this.treasureOpened = treasure.use(this.treasureOpenedSymbol).hide();\n\n\n    this.ground = this.groundGroup.polyline(terrainPoints)\n      .addClass('ground')\n      .translate(0, TERRAIN_DISTANCE)\n      .hide();\n\n    behindGroundGroup.clipWith(this.groundGroup.use(this.ground));\n\n    this.groundClip = this.groundGroup.clip();\n    this.groundGroup.clipWith(this.groundClip);\n\n    this.tangents = modeGroup.group()\n      .translate(0, TERRAIN_DISTANCE);\n  }\n\n  async handleExitMode() {\n    // Cleanup timers, etc. created on handleEnterMode\n  }\n\n  handleInputs(inputs, lastInputs, delta, ts) {\n    // Move the boats or check if they're lowering the probe\n\n    if (this.discardInputs)\n      return;\n\n    const { draw, numPlayers } = this.game;\n    inputs\n      .slice(0, numPlayers) // discard inputs that don't belong to an active player\n      .forEach((input, playerIndex) => {\n        const lastInput = lastInputs[playerIndex];\n        const actionDown = input.action && !lastInput.action;\n        if (this.gameOver && actionDown)\n          this.triggerEvent('done');\n\n        const player = this.players[playerIndex];\n        if (!player.probing && !this.gameOver) {\n          player.x += SPEED_FACTOR * (delta * input.direction);\n          player.x = Math.min(Math.max(TERRAIN_MARGIN_WIDTH, player.x), 1.0 - TERRAIN_MARGIN_WIDTH);\n          player.flipX = input.direction === 0 ? player.flipX : input.direction === -1;\n          if (actionDown) {\n            // Switch to probe mode\n            player.probing = true;\n            // Lower the probe, wait and raise it again\n            const terrainHeight = this.terrainHeight(player.x);\n            const probeHeight = TERRAIN_DISTANCE + TERRAIN_HEIGHT_SCALE * terrainHeight;\n            const probeDuration = probeHeight * (PROBE_MIN_DURATION / TERRAIN_DISTANCE);\n            const runnerDown = player.probe\n              .animate(probeDuration, 0, 'now')\n              .transform({ translateY: probeHeight })\n              .after(() => this.addGroundClip(player.x))\n              .after(() => this.addTangent(player));\n            const runnerUp = runnerDown.animate(probeDuration, PROBE_DELAY)\n              .transform({ translateY: TERRAIN_DISTANCE * PROBE_DISTANCE_AT_REST })\n              .after(() => player.probing = false);\n            const treasureFound = Math.abs(player.x - this.treasureLocation.x) <= TREASURE_SIZE / 2;\n            runnerDown.after(async () => {\n              if (treasureFound && !this.gameOver) {\n                console.log(\"Treasure found - GAME OVER!\");\n                // The game is now over, so a player that lowered the probe later can not win anymore.\n                this.gameOver = true;\n\n                // Disable all inputs until the ending sequence is over.\n                this.discardInputs = true;\n                const uncoverGroundPromise = this.uncoverGround();\n                await Promise.all(this.players.map(p => p.probingDone()));\n                await this.showGameOverSequence(player);\n                this.discardInputs = false;\n                await uncoverGroundPromise;\n              }\n            });\n\n\n            console.log(`Player ${playerIndex} is probing at:`, { x: player.x, y: terrainHeight });\n          }\n        }\n      });\n  }\n\n  draw(delta, ts) {\n    const { draw, numPlayers } = this.game;\n    // Move boats\n    // Draw bottom\n    // etc...\n\n    this.water.plot(this.wavesPoints(ts / WATER_LOOP_DURATION));\n\n    this.players.forEach((player, playerIndex) => {\n      const x = player.x;\n      const y = WATER_HEIGHT_SCALE * waves.height(x, ts / WATER_LOOP_DURATION);\n      const slope = WATER_HEIGHT_SCALE * waves.slope(x, ts / WATER_LOOP_DURATION);\n      const angle = 0.25 * 180 * Math.atan2(slope, draw.width()) / Math.PI;\n      const boatTransform = {\n        rotate: angle,\n      };\n      if (player.flipX)\n        boatTransform.flip = 'x';\n      player.boat.transform(boatTransform);\n      player.group.transform({\n        translateX: x * draw.width(),\n        translateY: y\n      });\n    });\n  }\n\n  terrainHeight(x) {\n    return this.terrainHeightExt(x).value;\n  }\n\n  terrainHeightExt(x) {\n    const xInArray = (this.terrainHeights.length - 1) * x;\n    const tmpIndex = Math.floor(xInArray);\n    const i0 = tmpIndex === this.terrainHeights.length - 1 ? tmpIndex - 1 : tmpIndex;\n    const i1 = i0 + 1;\n    const h0 = this.terrainHeights[i0];\n    const h1 = this.terrainHeights[i1];\n    const t = xInArray - i0;\n    return {\n      value: h0 + t * (h1 - h0),\n      slope: (h1 - h0) * (this.terrainHeights.length - 1),\n    };\n  }\n\n  locateTreasure() {\n    const argmax = array => [].reduce.call(array, (m, c, i, arr) => c > arr[m] ? i : m, 0);\n    const treasureIndex = argmax(this.terrainHeights);\n    return {\n      x: treasureIndex / (this.terrainHeights.length - 1),\n      y: this.terrainHeights[treasureIndex],\n    };\n  }\n\n  addTangent(player) {\n    const { draw } = this.game;\n    const width = draw.width();\n    const { value, slope } = this.terrainHeightExt(player.x);\n    const angle = 180 * Math.atan2(slope * TERRAIN_HEIGHT_SCALE, width) / Math.PI;\n    this.tangents.line(-width * TANGENT_LENGTH / 2, 0, width * TANGENT_LENGTH / 2, 0,)\n      .addClass(`player-${player.id}`)\n      .transform({\n        translateX: width * player.x,\n        translateY: TERRAIN_HEIGHT_SCALE * value,\n        rotate: angle,\n      });\n  }\n\n  addGroundClip(x) {\n    const { draw } = this.game;\n    const w = draw.width();\n    const h = draw.height();\n    const rect = this.groundClip\n      .polygon([[-w, -h], [w, -h], [w, h], [-w, h]])\n      .center(draw.width() * x, 0)\n      .transform({ scaleX: 0.001 });\n    this.groundClip.add(rect);\n  }\n\n  async uncoverGround() {\n    const { draw } = this.game;\n    this.ground.show();\n    const treasureSpotlight = this.groundClip.circle(2 * TREASURE_SIZE * draw.width())\n      .center(\n        draw.width() * this.treasureLocation.x,\n        TERRAIN_DISTANCE + TERRAIN_HEIGHT_SCALE * this.treasureLocation.y\n      );\n\n    // Move the treasure spotlight up a bit so it doesn't point at the treasure location on the\n    // curve, but rather at the treasure chest\n    treasureSpotlight.dy(-2 * 0.3 * TREASURE_SIZE * draw.width());\n\n    const uncoverGround = clip => new Promise(resolve => {\n      clip.animate(UNCOVER_DURATION)\n        .ease(pos => -(Math.sqrt(1 - (pos * pos)) - 1))\n        .transform({ scaleX: 1.0 })\n        .after(resolve);\n    });\n    return Promise.all(this.groundClip.children().map(uncoverGround));\n  }\n\n  async showGameOverSequence(winner) {\n    const { draw } = this.game;\n    const $overlay = $(this.game.overlay);\n\n    const delay = ms => new Promise(resolve => setTimeout(resolve, ms));\n\n    const treasureAnnouncement = IMAGINARY.i18n.t('treasure-announcement-begin')\n      + (winner.id + 1)\n      + IMAGINARY.i18n.t('treasure-announcement-end');\n    const randomElement = arr => arr[Math.floor(Math.random() * (arr.length - 1))];\n    const treasureString = randomElement(IMAGINARY.i18n.t('treasures'));\n    const restartString = IMAGINARY.i18n.t('press-to-restart');\n\n    const $treasureAnnouncementDiv = $('<div>').text(treasureAnnouncement);\n    const $treasureDiv = $('<div>').text(treasureString)\n      .css('visibility', 'hidden');\n    const $restartDiv = $('<div class=\"blinking\">').text(restartString)\n      .css('visibility', 'hidden');\n\n    const $inner = $(`<div class=\"ending-sequences-text player-${winner.id}\" />`)\n      .append([$treasureAnnouncementDiv, $treasureDiv, $('<br>'), $restartDiv]);\n\n    const left = 100 * this.treasureLocation.x;\n    const bottom = 100 - 100 * (WATER_DISTANCE + TERRAIN_DISTANCE) / draw.height();\n    const $outer = $('<div class=\"ending-sequences-text-container\">')\n      .css({ left: `${left}%`, bottom: `${bottom}%` })\n      .append($inner);\n\n    await delay(ENDING_SEQUENCE_DELAY);\n    $overlay.empty().append($outer);\n\n    await delay(ENDING_SEQUENCE_TREASURE_DELAY);\n    $treasureDiv.css(\"visibility\", \"visible\");\n    this.treasureOpened.show();\n    this.treasureClosed.hide();\n\n    await delay(ENDING_SEQUENCE_RESTART_DELAY);\n    $restartDiv.css(\"visibility\", \"visible\");\n  }\n}\n","/* globals IMAGINARY */\nimport GameMode from './game-mode';\nimport WavyAnimation from './wavy-animation';\n\nexport default class TitleMode extends GameMode {\n  async preLoadAssets() {\n    this.logoSprite = await this.game.loadSVGSymbol('assets/img/descent-logo.svg');\n    this.poly = this.logoSprite.findOne('#descent');\n  }\n\n  async handleEnterMode() {\n    const { draw } = this.game;\n    const pressToStart = document.createElement('div');\n    pressToStart.classList.add('blinking', 'text', 'text-center', 'text-vcenter');\n    pressToStart.textContent = IMAGINARY.i18n.t('press-to-start');\n    this.game.overlay.append(pressToStart);\n\n    const gradientLogo = draw.use(this.logoSprite)\n      .size(1200, 400)\n      .stroke({ color: '#00368a', width: 2 })\n      .fill('transparent')\n      .center(1920 / 2, 1080 / 2.5);\n\n    gradientLogo.animate({ duration: 5000 }).stroke({ color: '#34c6ff' });\n    this.wavyStep = WavyAnimation(this.logoSprite, { duration: 3500 });\n\n    this.animCounter = 0;\n  }\n\n  async handleExitMode() {\n    // Cleanup timers, etc. created on handleEnterMode\n  }\n\n  handleInputs(inputs, lastInputs, delta, ts0) {\n    // If any button was pressed\n    if (inputs\n      .find((ctrl, i) => ctrl.action && !lastInputs[i].action)) {\n      this.triggerEvent('done');\n    }\n  }\n\n  draw(delta, ts) {\n\n    this.wavyStep(delta, ts);\n  }\n}\n","/* eslint-disable class-methods-use-this,no-unused-vars,no-empty-function */\nimport EventEmitter from 'events';\n\n/**\n * Abstract class for GameMode\n *\n * A GameMode does the actual handling of the input and drawing\n */\nexport default class GameMode {\n  /**\n   * Constructor\n   *\n   * @param {GradientDescentGame} game\n   */\n  constructor(game) {\n    // noinspection JSUnusedGlobalSymbols\n    this.game = game;\n    this.events = new EventEmitter();\n  }\n\n  /**\n   * Preload any external assets that will be needed during the game\n   *\n   * This method runs during game initialization.\n   * @return {Promise<void>}\n   */\n  async preLoadAssets() {\n\n  }\n\n  /**\n   * Called by the game when the mode is entered.\n   *\n   * Can be used to add DOM elements, event handlers and initialize\n   * internal state. Anything done here must be cleaned up in\n   * handleExitMode.\n   */\n  async handleEnterMode() {\n\n  }\n\n  /**\n   * Called by the game when the mode is going to be exited\n   *\n   * Should be used to remove DOM elements, event handlers\n   * or anything else that was created on handleEnterMode.\n   */\n  async handleExitMode() {\n\n  }\n\n  /**\n   * Called once per frame so the mode can handle controller input\n   *\n   * Current input state and the previous one are passed\n   * to help with state change detection.\n   *\n   * Both are arrays with N objects with shape:\n   * - direction {integer}: Either -1, 0 or 1.\n   * - action {bool}\n   *\n   * @param {[{direction: Number, action: Boolean}]} inputs\n   * @param {[{direction: Number, action: Boolean}]} lastInputs\n   * @param {Number} delta\n   *  Amount of milliseconds since the last call (capped to a maximum)\n   * @param {Number} ts\n   *  Timestamp received via requestAnimationFrame\n\n   *\n   */\n  handleInputs(inputs, lastInputs, delta, ts) {\n\n  }\n\n  /**\n   * Called once per frame so the mode can draw based on the game's state\n   *\n   * @param {Number} delta\n   *  Amount of milliseconds since the last call (capped to a maximum)\n   * @param {Number} ts\n   *  Timestamp received via requestAnimationFrame\n   */\n  draw(delta, ts) {\n\n  }\n\n  /**\n   * Triggers an event for the game to handle\n   *\n   * Events can be used to transition to another mode, etc.\n   *\n   * @param {string} name\n   */\n  triggerEvent(name) {\n    this.events.emit(name);\n  }\n}\n","/* globals SVG */\nimport PlayMode from './game-mode-play';\nimport TitleMode from './game-mode-title';\nimport PlayerNumberMode from './game-mode-numplayers';\nimport GamepadControls from \"./controls/gamepad\";\nimport ScreenControls from './controls/screen';\nimport KeyboardControls from \"./controls/keyboard\";\n\n/**\n * The main application\n *\n * This class creates the main UI elements and runs the\n * main game loop (read input, draw).\n *\n * The game can be in one of various modes (see GameMode)\n * which decides how to draw and process input.\n */\nexport default class GradientDescentGame {\n  constructor(container, config) {\n    this.container = container;\n    this.config = config;\n\n    this.inputs = this.createInputs();\n    this.inputsLast = this.createInputs();\n\n    this.gameLoop = null;\n    this.isPaused = false;\n    this.modes = {};\n    this.currentMode = null;\n\n    this.controls = {};\n    this.debugControlsPane = null;\n\n    this.numPlayers = this.config.maxPlayers;\n  }\n\n  /**\n   * Initializes the app and downloads any external assets\n   *\n   * @return {Promise<void>}\n   */\n  async init() {\n    const [width, height] = [1920, 864];\n    this.overlay = document.createElement('div');\n    this.overlay.classList.add('overlay');\n\n    const viewContainer = document.createElement('div');\n    viewContainer.classList.add('game-view');\n    this.container.append(viewContainer);\n\n    this.svgDoc = SVG().addTo(viewContainer);\n    this.svgDoc\n      .viewbox(0, 0, width, height)\n      .attr('preserveAspectRatio', 'xMinYMin meet');\n\n    this.draw = this.svgDoc.nested().size(width, height);\n\n    this.overlay = document.createElement('div');\n    this.overlay.classList.add('overlay');\n    this.container.append(this.overlay);\n\n    if (this.config.useScreenControls) {\n      this.controls.screen = new ScreenControls(this.config.maxPlayers);\n      this.container.appendChild(this.controls.screen.element);\n    }\n\n    if (this.config.useGamepads) {\n      this.controls.gamepad = new GamepadControls(this.config.maxPlayers);\n    }\n    if (this.config.useKeyboardControls) {\n      this.controls.keyboard = new KeyboardControls(this.config.maxPlayers);\n    }\n\n    if (this.config.debugControls) {\n      this.debugControlsPane = document.createElement('div');\n      this.debugControlsPane.classList.add('debug-pane');\n      this.debugControlsPane.classList.add('debug-pane-controls');\n      this.container.appendChild(this.debugControlsPane);\n    }\n\n    await this.registerMode('title', new TitleMode(this));\n    await this.registerMode('numplayers', new PlayerNumberMode(this));\n    await this.registerMode('play', new PlayMode(this));\n\n    if (this.config.continuousGame) {\n      this.transition('play', 'done', 'play');\n      await this.setMode('play');\n    } else {\n      this.transition('title', 'done',\n        this.config.maxPlayers > 1 ? 'numplayers' : 'play');\n      this.transition('numplayers', 'done', 'play');\n      this.transition('play', 'done', 'title');\n      await this.setMode('title');\n    }\n  }\n\n  /**\n   * Loads an external SVG file into a symbol within the main svg element\n   *\n   * @param {string} uri\n   * @param {boolean} clearStyles\n   *  If true removes the style elements from the file\n   * @return {Promise<SVG.Symbol>}\n   */\n  async loadSVGSymbol(uri, clearStyles = true) {\n    const response = await fetch(uri);\n    if (response.status < 200 || response.status >= 300) {\n      throw new Error(`Server returned status ${response.status} (${response.statusText}) loading ${uri}.`);\n    }\n    const newSymbol = this.svgDoc.symbol().svg(await response.text());\n    if (clearStyles) {\n      newSymbol.find('style').forEach(s => s.remove());\n    }\n\n    return newSymbol;\n  }\n\n  /**\n   * Initializes the input state\n   *\n   * @private\n   */\n  initInputs() {\n    this.inputs = this.createInputs();\n  }\n\n  createInputs() {\n    return Array(this.config.maxPlayers)\n      .fill(null)\n      .map(() => ({ direction: 0, action: false }));\n  }\n\n  /**\n   * Reads the input state from all enabled controller types\n   *\n   * Loads the new input state in this.input and the previous\n   * state in this.inputLast.\n   *\n   * @private\n   */\n  readInputs() {\n    this.inputsLast = this.inputs;\n    const states = Object.values(this.controls).map(c => c.getStates());\n    const inputReducer = (accInput, curState) => ({\n      direction: curState.right ? 1 : (curState.left ? -1 : accInput.direction),\n      action: curState.action || accInput.action,\n    });\n    this.inputs = this.createInputs().map(\n      (input, i) => states.map(s => s[i]).reduce(inputReducer, input)\n    );\n\n    if (this.debugControlsPane) {\n      this.debugControlsPane.textContent = this.inputs.map((ctrl, i) => (\n        `C${i}: d=${ctrl.direction} a=${ctrl.action ? 'T' : 'F'}`\n      )).join('\\u00a0\\u00a0\\u00a0\\u00a0'); // four &nbsp;\n    }\n  }\n\n  /**\n   * Game loop\n   */\n  run() {\n    if (!this.gameLoop) {\n      let lastTs = 0;\n      let lag = 0;\n      const MAX_DELTA = 125;\n\n      this.gameLoop = (ts) => {\n        if (!this.isPaused) {\n          this.readInputs();\n          lag += Math.max(0, (ts - lag) - lastTs - MAX_DELTA);\n          ts -= lag;\n          const delta = ts - lastTs;\n          this.currentMode.handleInputs(this.inputs, this.inputsLast, delta, ts);\n          this.currentMode.draw(delta, ts);\n          lastTs = ts;\n\n          window.requestAnimationFrame(this.gameLoop);\n        }\n      };\n    }\n    window.requestAnimationFrame(this.gameLoop);\n  }\n\n  /**\n   * Pauses the game.\n   *\n   * While paused the main game loop not run.\n   */\n  pause() {\n    this.isPaused = true;\n  }\n\n  /**\n   * Resumes the game.\n   *\n   * Enables the main game loop.\n   */\n  resume() {\n    if (this.isPaused) {\n      this.isPaused = false;\n      this.run();\n    }\n  }\n\n  /**\n   * Registers a game mode\n   *\n   * @private\n   * @param {string} id\n   *  A name that identifies the mode\n   * @param {GameMode} mode\n   *  A GameMode subclass\n   * @return {Promise<void>}\n   */\n  async registerMode(id, mode) {\n    this.modes[id] = mode;\n    await mode.preLoadAssets();\n  }\n\n  /**\n   * Changes the current game mode\n   *\n   * @param {string} modeID\n   *  Name of a previously registered mode\n   * @return {Promise<void>}\n   */\n  async setMode(modeID) {\n    this.pause();\n\n    if (this.currentMode) {\n      await this.currentMode.handleExitMode();\n    }\n    if (this.modes[modeID] === undefined) {\n      throw new Error(`Can't change to unknown mode ${modeID}`);\n    }\n    this.currentMode = this.modes[modeID];\n    this.draw.clear();\n    this.overlay.innerHTML = '';\n    await this.currentMode.handleEnterMode();\n\n    this.resume();\n  }\n\n  transition(modeId, event, nextModeId = null, callback = null) {\n    if (this.modes[modeId] === undefined) {\n      throw new Error(`Can't define transition from unknown game mode '${modeId}'`);\n    }\n    if (nextModeId && this.modes[nextModeId] === undefined) {\n      throw new Error(`Can't define transition to unknown game mode '${nextModeId}'`);\n    }\n    this.modes[modeId].events.on(event, () => {\n      if (this.currentMode !== this.modes[modeId]) {\n        throw new Error(`Mode ${modeId} triggered the event ${event} while not active. Something was not cleaned up?`);\n      }\n      if (nextModeId !== null) {\n        this.setMode(nextModeId);\n      }\n      if (callback && typeof callback === 'function') {\n        callback();\n      }\n    });\n  }\n}\n","/* globals IMAGINARY */\nimport GradientDescentGame from './game';\n\nconst defaultConfig = {\n  defaultLanguage: 'en',\n  useGamepads: true,\n  useScreenControls: true,\n  maxPlayers: 2,\n  continuousGame: false,\n  debugControls: false,\n};\n\n/**\n * Loads the config file from an external JSON file\n *\n * @param {String} uri\n * @return {Promise<any>}\n */\nasync function loadConfig(uri) {\n  const response = await fetch(uri);\n  if (response.status >= 200 && response.status < 300) {\n    try {\n      return await response.json();\n    } catch (e) {\n      throw new Error(`Error parsing config file: ${e.message}`);\n    }\n  }\n  throw new Error(`Server returned status ${response.status} (${response.statusText}) loading config file.`);\n}\n\n/**\n * Load config files and start the program\n */\n(async function main() {\n  try {\n    const config = Object.assign({}, defaultConfig, await loadConfig('./config.json'));\n    await IMAGINARY.i18n.init({\n      queryStringVariable: 'lang',\n      translationsDirectory: 'tr',\n      defaultLanguage: config.defaultLanguage || 'en',\n    });\n    // eslint-disable-next-line no-unused-vars\n    const game = new GradientDescentGame(\n      document.querySelector('.main'),\n      config\n    );\n    window.game = game;\n    await game.init();\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.error(err);\n  }\n}());\n","function smoothChaikin(arr, num, open = true) {\n  if (num === 0)\n    return arr;\n\n  const l = arr.length;\n  const smooth = arr.map((c, i) => [\n    [0.75 * c[0] + 0.25 * arr[(i + 1) % l][0], 0.75 * c[1] + 0.25 * arr[(i + 1) % l][1]],\n    [0.25 * c[0] + 0.75 * arr[(i + 1) % l][0], 0.25 * c[1] + 0.75 * arr[(i + 1) % l][1]]\n  ]).flat();\n\n  if (open) {\n    smooth.length -= 1;\n    smooth[0] = arr[0];\n    smooth[smooth.length - 1] = arr[arr.length - 1];\n  }\n\n  return smoothChaikin(smooth, num - 1, open);\n}\n\nfunction subdivide(length, leftHeight, rightHeight) {\n  return {\n    index: Math.floor(length * Math.random()),\n    height: Math.max(leftHeight, rightHeight) * Math.random(),\n  };\n}\n\nfunction generateInnerTerrainHeights(heights, leftHeight, rightHeight) {\n  if (heights.length > 0) {\n    const { index, height } = subdivide(heights.length, leftHeight, rightHeight);\n    heights[index] = height;\n    generateInnerTerrainHeights(heights.subarray(0, index), leftHeight, height);\n    generateInnerTerrainHeights(heights.subarray(index + 1, heights.length),\n      height,\n      rightHeight);\n  }\n  return heights;\n}\n\nfunction generateTerrainPoints(numPoints, marginWidth = 0.1, marginHeight = 0.2, jitter = 0.25) {\n  const heights = new Float32Array(numPoints);\n  const marginIndices = [\n    Math.floor(marginWidth * numPoints),\n    Math.floor(marginWidth + (1 - 2 * marginWidth) * numPoints),\n  ];\n  const predefinedHeights = [\n    [0, Math.random() * marginHeight],\n    [marginIndices[0], marginHeight],\n    [marginIndices[0] + 1 + Math.floor(Math.random() * (marginIndices[1] - marginIndices[0])),\n     1.0],\n    [marginIndices[1], marginHeight],\n    [numPoints - 1, Math.random() * marginHeight],\n  ];\n\n  if (numPoints > 0) {\n    predefinedHeights.forEach(([i, h]) => heights[i] = h);\n    predefinedHeights.reduce(([i0, h0], [i1, h1]) => {\n      generateInnerTerrainHeights(heights.subarray(i0 + 1, i1), h0, h1);\n      return [i1, h1];\n    });\n  }\n\n  // restrict jitter range to prevent points from switching their order\n  jitter = Math.max(0.0, Math.min(jitter, 1.0));\n\n  return new Array(heights.length)\n    .fill(null)\n    .map((_, i) => [\n      (i + jitter * (Math.random() - 0.5)) / (heights.length - 1),\n      heights[i]\n    ]);\n}\n\nfunction convertPointsToHeights(points, numHeights) {\n  const left = points[0][0];\n  const right = points[points.length - 1][0];\n  const width = right - left;\n  const heights = Array(numHeights);\n  let j = 0;\n  for (let i = 0; i < heights.length - 1; ++i) {\n    while (i >= (numHeights - 1) * (points[j][0] - left) / width) {\n      ++j;\n    }\n    const t = (left + ((i / (numHeights - 1)) * width) - (points[j - 1][0]))\n      / (points[j][0] - points[j - 1][0]);\n    heights[i] = points[j - 1][1] + (points[j][1] - points[j - 1][1]) * t;\n  }\n  heights[heights.length - 1] = points[points.length - 1][1];\n  return heights;\n}\n\nconst defaultOptions = {\n  marginWidth: 0.1,\n  marginHeight: 0.1,\n  jitter: 0.25,\n  smoothing: 6,\n};\n\nexport default function terrain(numSamples, length, options = {}) {\n  options = Object.assign({}, defaultOptions, options);\n  const roughTerrainPoints = generateTerrainPoints(\n    numSamples,\n    options.marginWidth,\n    options.marginHeight,\n    options.jitter\n  );\n  const smoothTerrainPoints = smoothChaikin(roughTerrainPoints, options.smoothing);\n  const smoothTerrainHeights = convertPointsToHeights(smoothTerrainPoints, length);\n  return smoothTerrainHeights;\n}\n","// The water surface consists of superimposed sin waves that are moving with respect to ts.\n// Fixing x, the frequency factors with respect to ts are [1,-1,2,3].\n// Since the lowest common denominator of these factors is 6 and the base frequency is 1 / (2 * PI),\n// the period of the water animation is 6 / (1 / (2 * PI)) = 12 * PI.\nconst PERIOD = 12 * Math.PI;\n\nexport function height(x, t) {\n  t = (t * PERIOD) % PERIOD;\n  return (\n    Math.sin(x * 100 + t)\n    + Math.sin(x * 50 - 1 * t)\n    + Math.sin(x * 30 + 2 * t)\n    + Math.sin(x * 10 - 3 * t)\n  ) / 4;\n}\n\nexport function slope(x, t) {\n  t = (t * PERIOD) % PERIOD;\n  return (\n    100 * Math.cos(100 * x + t)\n    + 50 * Math.cos(50 * x - t)\n    + 30 * Math.cos(30 * x + 2 * t)\n    + 10 * Math.cos(10 * x - 3 * t)\n  ) / 4;\n}\n\nexport function heights(arr, t, xScale = 1.0, yScale = 1.0) {\n  arr.forEach((_, i) => arr[i] = height(i / (arr.length - 1), t));\n  return arr;\n}\n\nexport function points(arr, t, xScale = 1.0, yScale = 1.0) {\n  arr.forEach((_, i) => {\n    const x = i / (arr.length - 1);\n    arr[i] = [xScale * x, yScale * height(x, t)];\n  });\n  return arr;\n}\n\n/*\n * Experimental: Create an SVG wave shape that animates via the <animate> tag.\n * This will probably doesn't work in a lot of browsers.\n * Problems: It's not possible to the the timestamp (progress) of the animation,\n * which would be needed to keep it in sync with other elements in the scene.\n */\nexport function animatedSVG(svgContainer, numPoints, numSteps, xScale, yScale, duration) {\n  const p = Array(numPoints).fill(null);\n  const keyframes = Array(numSteps)\n    .fill(null)\n    .map((_, i) => Array.from(points(p, i / (numSteps - 1), xScale, yScale)));\n  const waves = svgContainer.polyline(keyframes[0]);\n  const keyframesSvg = keyframes.map(p => waves.plot(p).attr('points'));\n  const keyframesString = keyframesSvg.join(';\\n').replace(/;[[:space:]]*;]/g, ';');\n  const animate = waves.element('animate');\n  animate.attr({\n    attributeName: 'points',\n    dur: `${duration}ms`,\n    repeatCount: 'indefinite',\n    values: keyframesString,\n  });\n\n  return waves;\n}\n\n","/**\n * Setup a wave-like animation for an svg.js shape made up of polygons.\n *\n * This animation works by applying a transformation on all points of\n * all polygons of the passed shape. The points will move on a sine wave\n * that is continuously phase shifting and whose amplitude decreases over time.\n *\n * Returns a stepping function that takes a delta in milliseconds which should\n * be called on the frame rendering function.\n *\n * Options:\n * - xAmplitude: Maximum distance that the x coordinates are shifted from their\n *   starting position.\n * - duration: Duration of the animation\n * - cycles: Number of cycles of phase shifting.\n *\n * @param {SVG.Container} shape\n *  The shape whose polygons will be animated\n * @param {Object} userOptions\n *  Options (see above)\n * @return {function(...[*]=)}\n *  Returns an animation callback that takes a delta.\n */\nexport default function WavyAnimation(shape, userOptions = {}) {\n  const defaultOptions = {\n    xAmplitude: 50,\n    duration: 5000,\n    cycles: 3,\n  };\n\n  const options = Object.assign({}, defaultOptions, userOptions);\n  const polygons = shape.find('polygon');\n  const originalPlots = polygons.map(p => p.plot());\n  const maxY = Math.max(...originalPlots.flat().map(([, y]) => y));\n\n  let counter = 0;\n\n  return (delta, ts) => {\n    if (counter > options.duration) {\n      return;\n    }\n    counter += delta;\n    const progress = Math.min(counter, options.duration) / options.duration;\n    polygons.forEach((p, i) => {\n      p.plot(originalPlots[i].map(([x, y]) => (\n        [\n          x + Math.sin((y / maxY + progress * options.cycles) * Math.PI * 2)\n          * options.xAmplitude * (1 - (progress ** 2)),\n          y,\n        ]\n      )));\n    });\n  };\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nvar objectCreate = Object.create || objectCreatePolyfill\nvar objectKeys = Object.keys || objectKeysPolyfill\nvar bind = Function.prototype.bind || functionBindPolyfill\n\nfunction EventEmitter() {\n  if (!this._events || !Object.prototype.hasOwnProperty.call(this, '_events')) {\n    this._events = objectCreate(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nvar hasDefineProperty;\ntry {\n  var o = {};\n  if (Object.defineProperty) Object.defineProperty(o, 'x', { value: 0 });\n  hasDefineProperty = o.x === 0;\n} catch (err) { hasDefineProperty = false }\nif (hasDefineProperty) {\n  Object.defineProperty(EventEmitter, 'defaultMaxListeners', {\n    enumerable: true,\n    get: function() {\n      return defaultMaxListeners;\n    },\n    set: function(arg) {\n      // check whether the input is a positive number (whose value is zero or\n      // greater and not a NaN).\n      if (typeof arg !== 'number' || arg < 0 || arg !== arg)\n        throw new TypeError('\"defaultMaxListeners\" must be a positive number');\n      defaultMaxListeners = arg;\n    }\n  });\n} else {\n  EventEmitter.defaultMaxListeners = defaultMaxListeners;\n}\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || isNaN(n))\n    throw new TypeError('\"n\" argument must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nfunction $getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return $getMaxListeners(this);\n};\n\n// These standalone emit* functions are used to optimize calling of event\n// handlers for fast cases because emit() itself often has a variable number of\n// arguments and can be deoptimized because of that. These functions always have\n// the same number of arguments and thus do not get deoptimized, so the code\n// inside them can execute faster.\nfunction emitNone(handler, isFn, self) {\n  if (isFn)\n    handler.call(self);\n  else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      listeners[i].call(self);\n  }\n}\nfunction emitOne(handler, isFn, self, arg1) {\n  if (isFn)\n    handler.call(self, arg1);\n  else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      listeners[i].call(self, arg1);\n  }\n}\nfunction emitTwo(handler, isFn, self, arg1, arg2) {\n  if (isFn)\n    handler.call(self, arg1, arg2);\n  else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      listeners[i].call(self, arg1, arg2);\n  }\n}\nfunction emitThree(handler, isFn, self, arg1, arg2, arg3) {\n  if (isFn)\n    handler.call(self, arg1, arg2, arg3);\n  else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      listeners[i].call(self, arg1, arg2, arg3);\n  }\n}\n\nfunction emitMany(handler, isFn, self, args) {\n  if (isFn)\n    handler.apply(self, args);\n  else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      listeners[i].apply(self, args);\n  }\n}\n\nEventEmitter.prototype.emit = function emit(type) {\n  var er, handler, len, args, i, events;\n  var doError = (type === 'error');\n\n  events = this._events;\n  if (events)\n    doError = (doError && events.error == null);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    if (arguments.length > 1)\n      er = arguments[1];\n    if (er instanceof Error) {\n      throw er; // Unhandled 'error' event\n    } else {\n      // At least give some kind of context to the user\n      var err = new Error('Unhandled \"error\" event. (' + er + ')');\n      err.context = er;\n      throw err;\n    }\n    return false;\n  }\n\n  handler = events[type];\n\n  if (!handler)\n    return false;\n\n  var isFn = typeof handler === 'function';\n  len = arguments.length;\n  switch (len) {\n      // fast cases\n    case 1:\n      emitNone(handler, isFn, this);\n      break;\n    case 2:\n      emitOne(handler, isFn, this, arguments[1]);\n      break;\n    case 3:\n      emitTwo(handler, isFn, this, arguments[1], arguments[2]);\n      break;\n    case 4:\n      emitThree(handler, isFn, this, arguments[1], arguments[2], arguments[3]);\n      break;\n      // slower\n    default:\n      args = new Array(len - 1);\n      for (i = 1; i < len; i++)\n        args[i - 1] = arguments[i];\n      emitMany(handler, isFn, this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  if (typeof listener !== 'function')\n    throw new TypeError('\"listener\" argument must be a function');\n\n  events = target._events;\n  if (!events) {\n    events = target._events = objectCreate(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener) {\n      target.emit('newListener', type,\n          listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (!existing) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n          prepend ? [listener, existing] : [existing, listener];\n    } else {\n      // If we've already got an array, just append.\n      if (prepend) {\n        existing.unshift(listener);\n      } else {\n        existing.push(listener);\n      }\n    }\n\n    // Check for listener leak\n    if (!existing.warned) {\n      m = $getMaxListeners(target);\n      if (m && m > 0 && existing.length > m) {\n        existing.warned = true;\n        var w = new Error('Possible EventEmitter memory leak detected. ' +\n            existing.length + ' \"' + String(type) + '\" listeners ' +\n            'added. Use emitter.setMaxListeners() to ' +\n            'increase limit.');\n        w.name = 'MaxListenersExceededWarning';\n        w.emitter = target;\n        w.type = type;\n        w.count = existing.length;\n        if (typeof console === 'object' && console.warn) {\n          console.warn('%s: %s', w.name, w.message);\n        }\n      }\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    switch (arguments.length) {\n      case 0:\n        return this.listener.call(this.target);\n      case 1:\n        return this.listener.call(this.target, arguments[0]);\n      case 2:\n        return this.listener.call(this.target, arguments[0], arguments[1]);\n      case 3:\n        return this.listener.call(this.target, arguments[0], arguments[1],\n            arguments[2]);\n      default:\n        var args = new Array(arguments.length);\n        for (var i = 0; i < args.length; ++i)\n          args[i] = arguments[i];\n        this.listener.apply(this.target, args);\n    }\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = bind.call(onceWrapper, state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  if (typeof listener !== 'function')\n    throw new TypeError('\"listener\" argument must be a function');\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      if (typeof listener !== 'function')\n        throw new TypeError('\"listener\" argument must be a function');\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      if (typeof listener !== 'function')\n        throw new TypeError('\"listener\" argument must be a function');\n\n      events = this._events;\n      if (!events)\n        return this;\n\n      list = events[type];\n      if (!list)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = objectCreate(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else\n          spliceOne(list, position);\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (!events)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (!events.removeListener) {\n        if (arguments.length === 0) {\n          this._events = objectCreate(null);\n          this._eventsCount = 0;\n        } else if (events[type]) {\n          if (--this._eventsCount === 0)\n            this._events = objectCreate(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = objectKeys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = objectCreate(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (!events)\n    return [];\n\n  var evlistener = events[type];\n  if (!evlistener)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ? unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? Reflect.ownKeys(this._events) : [];\n};\n\n// About 1.5x faster than the two-arg version of Array#splice().\nfunction spliceOne(list, index) {\n  for (var i = index, k = i + 1, n = list.length; k < n; i += 1, k += 1)\n    list[i] = list[k];\n  list.pop();\n}\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n\nfunction objectCreatePolyfill(proto) {\n  var F = function() {};\n  F.prototype = proto;\n  return new F;\n}\nfunction objectKeysPolyfill(obj) {\n  var keys = [];\n  for (var k in obj) if (Object.prototype.hasOwnProperty.call(obj, k)) {\n    keys.push(k);\n  }\n  return k;\n}\nfunction functionBindPolyfill(context) {\n  var fn = this;\n  return function () {\n    return fn.apply(context, arguments);\n  };\n}\n"]}